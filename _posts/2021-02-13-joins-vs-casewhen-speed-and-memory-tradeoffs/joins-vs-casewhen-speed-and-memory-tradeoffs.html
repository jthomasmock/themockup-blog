<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Joins vs case whens - speed and memory tradeoffs</title>

  <meta property="description" itemprop="description" content="Spoiler - joins are fastest, and can be easy to prep!"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-02-13"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-02-13"/>
  <meta name="article:author" content="Thomas Mock"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Joins vs case whens - speed and memory tradeoffs"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Spoiler - joins are fastest, and can be easy to prep!"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Joins vs case whens - speed and memory tradeoffs"/>
  <meta property="twitter:description" content="Spoiler - joins are fastest, and can be easy to prep!"/>
  <meta property="twitter:site" content="@thomas_mock"/>
  <meta property="twitter:creator" content="@thomas_mock"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","preview","twitter","categories"]}},"value":[{"type":"character","attributes":{},"value":["Joins vs case whens - speed and memory tradeoffs"]},{"type":"character","attributes":{},"value":["Spoiler - joins are fastest, and can be easy to prep!\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Thomas Mock"]},{"type":"character","attributes":{},"value":["https://twitter.com/thomas_mock"]}]}]},{"type":"character","attributes":{},"value":["02-13-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["toc","toc_depth","self_contained","highlight","highlight_downlit","code_folding"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["default"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["preview.jpeg"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["site","creator"]}},"value":[{"type":"character","attributes":{},"value":["@thomas_mock"]},{"type":"character","attributes":{},"value":["@thomas_mock"]}]},{"type":"character","attributes":{},"value":["tidyverse","data cleaning","joins"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["joins-vs-casewhen-speed-and-memory-tradeoffs_files/anchor-4.2.2/anchor.min.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/bowser-1.9.3/bowser.min.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/distill-2.2.21/template.v2.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/header-attrs-2.6.6/header-attrs.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/header-attrs-2.7.0/header-attrs.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/jquery-1.11.3/jquery.min.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/popper-2.6.0/popper.min.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy-bundle.umd.min.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy-light-border.css","joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy.css","joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy.umd.min.js","joins-vs-casewhen-speed-and-memory-tradeoffs_files/webcomponents-2.0.0/webcomponents.js","preview.jpeg"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/header-attrs-2.6.6/header-attrs.js"></script>
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/popper-2.6.0/popper.min.js"></script>
  <link href="joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="joins-vs-casewhen-speed-and-memory-tradeoffs_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Joins vs case whens - speed and memory tradeoffs","description":"Spoiler - joins are fastest, and can be easy to prep!","authors":[{"author":"Thomas Mock","authorURL":"https://twitter.com/thomas_mock","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-02-13T00:00:00.000-06:00","citationText":"Mock, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Joins vs case whens - speed and memory tradeoffs</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">tidyverse</div>
<div class="dt=tag">data cleaning</div>
<div class="dt=tag">joins</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>Spoiler - joins are fastest, and can be easy to prep!</p></p>
</div>

<div class="d-byline">
  Thomas Mock <a href="https://twitter.com/thomas_mock" class="uri">https://twitter.com/thomas_mock</a> 
  
<br/>02-13-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#matching-names">Matching names</a>
<ul>
<li><a href="#example-data">Example Data</a></li>
<li><a href="#dplyrcase_when-solution"><code>dplyr::case_when()</code> solution</a>
<ul>
<li><a href="#step-1-datapasta">Step 1: <code>datapasta</code></a></li>
<li><a href="#step-2-multiple-line-selection-in-rstudio">Step 2: Multiple line selection in RStudio</a></li>
</ul></li>
<li><a href="#a-join-solution">A join solution</a>
<ul>
<li><a href="#tribble"><code>tribble</code></a></li>
</ul></li>
<li><a href="#data.tablefcase"><code>data.table::fcase</code></a></li>
</ul></li>
<li><a href="#speed-and-memory">Speed and Memory</a></li>
</ul>
</nav>
</div>
<h1 id="matching-names">Matching names</h1>
<p>There are many times where you may have a reference dataset that has some type of short-code, abbreviations, nicknames, or even misspellings. In this situation we want to create a new column or even overwrite the existing column with the correct spelling, the full name, etc.</p>
<p>While there isn’t a <strong>wrong</strong> way to do this, I’ve made mistakes in the past of making things more complicated for myself during data cleaning/prep steps. Most importantly to me in my data cleaning steps are “speed of thought” - aka how long it takes me to type out or reason through, but there are also tradeoffs in memory usage and in execution speed.</p>
<p>I’m going to step through some strategies, honed by years of TidyTuesday data cleaning and prep!</p>
<hr />
<p>In general I want to preface all these examples with the fact that this exercise is easily translatable to various <code>join</code> options. Joins are great, but there are situations where the logicals aren’t simple matches/index (like <code>x == "val"</code>) but rather more complex queries (like <code>x &gt; 5 &amp; var %in% c("val", "val2")</code>), but I’m going to live within the constraints of my example use case. Also note that joins could join on more than one key or add as many variables as needed rather than just one, so there’s additional complexity possible here.</p>
<hr />
<p>To avoid burying the lede, joins are by far the fastest and most memory-efficient method if you can fit your problem to that solution, <code>data.table::fcase()</code> provides a easy to use and remarkably fast/memory-efficient intermediate method that works in base R, <code>data.tables</code> or <code>dplyr</code>, and <code>dplyr::case_when()</code> is the slowest/most-memory hungry for in-memory cases, BUT is probably fast enough for relatively small data (&lt; 1,000,000 rows) and is the option that allows pushing compute into a remote backend via <code>dbplyr</code>/<code>sparklyr</code>.</p>
<hr />
<h2 id="example-data">Example Data</h2>
<p>We’re going to simulate a dataset with NFL team abbreviations and a “stat” that is relatively in scope with something like EPA, but again this is all simulated data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>

<span class='co'># relatively nice sized dataset (100,000 rows)</span>
<span class='va'>sample_size</span> <span class='op'>&lt;-</span> <span class='fl'>100000</span>

<span class='co'># Get example team names from espn</span>
<span class='va'>all_teams</span> <span class='op'>&lt;-</span> <span class='fu'>espnscrapeR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/espnscrapeR/man/get_nfl_teams.html'>get_nfl_teams</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># set a reproducible seed (h/t to Anthony's wife's new $4 luggage...)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>829</span><span class='op'>)</span>

<span class='va'>ex_df</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>
  team <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='va'>all_teams</span><span class='op'>$</span><span class='va'>team_short_name</span>, size <span class='op'>=</span> <span class='va'>sample_size</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  stat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>sample_size</span>, mean <span class='op'>=</span> <span class='fl'>0.1</span>, sd <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='va'>ex_df</span>
</code></pre>
</div>
<pre><code># A tibble: 100,000 x 2
   team     stat
   &lt;chr&gt;   &lt;dbl&gt;
 1 HOU    0.0593
 2 JAX   -0.0534
 3 DEN   -0.0488
 4 NO    -0.0527
 5 CAR    0.111 
 6 CHI    0.132 
 7 CAR    0.0481
 8 IND    0.412 
 9 HOU    0.0425
10 ARI    0.200 
# … with 99,990 more rows</code></pre>
</div>
<h2 id="dplyrcase_when-solution"><code>dplyr::case_when()</code> solution</h2>
<p>There’s a fantastic function in the <code>dplyr</code> package called <code>case_when()</code>.</p>
<p><a href="https://dplyr.tidyverse.org/reference/case_when.html"><code>case_when</code></a>:</p>
<blockquote>
<p>This function allows you to vectorise multiple if_else()</p>
</blockquote>
<p>In essence, this provides the ability to provide many logical statements to generate a specific outcome. You can read more about the syntax via: <code>?dplyr::case_when()</code> in the R console or the <a href="https://dplyr.tidyverse.org/reference/case_when.html">docs</a>. This functions works on vectors as well as in mutations inside data.frames/tibbles/data.tables. Lastly, it can also be translated into SQL automatically via <code>dbplyr</code> in situations where you don’t want to bring all the data into memory.</p>
<p><code>case_when</code> is very readable to me, and feels better than a whole bundle of nested <code>ifelse</code>/<code>if_else</code> statements.</p>
<hr />
<p>A quick <code>reprex</code> of <code>case_when()</code> usage.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ex_car</span> <span class='op'>&lt;-</span> <span class='va'>mpg</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>cyl</span>, <span class='va'>cty</span>, <span class='va'>hwy</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice_sample</span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>

<span class='va'>ex_car</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    cyl_character <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
      <span class='co'># if logical statement is TRUE then assign new value</span>
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>4</span> <span class='op'>~</span> <span class='st'>"Four"</span>,
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span> <span class='op'>~</span> <span class='st'>"Six"</span>,
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>8</span> <span class='op'>~</span> <span class='st'>"Eight"</span>,
      <span class='co'># This last statement means, if none of the above conditions are met</span>
      <span class='co'># then return a NA value, note that case_when is type-safe</span>
      <span class='co'># so you'll want to use the various NA_??? for the type of output</span>
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 100 x 5
   model                 cyl   cty   hwy cyl_character
   &lt;chr&gt;               &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;        
 1 a4                      4    20    31 Four         
 2 malibu                  4    22    30 Four         
 3 ram 1500 pickup 4wd     8     9    12 Eight        
 4 jetta                   5    21    29 &lt;NA&gt;         
 5 passat                  4    18    29 Four         
 6 camry solara            6    18    26 Six          
 7 f150 pickup 4wd         8    13    16 Eight        
 8 a4 quattro              6    17    25 Six          
 9 grand cherokee 4wd      8    14    19 Eight        
10 jetta                   4    22    29 Four         
# … with 90 more rows</code></pre>
</div>
<hr />
<p>Now that we understand the syntax a bit better, let’s try it on our dataset of interest! Remember, we want to take our team abbreviations and add the team names into the dataset. So we’ll need to provide a logical match of each <code>team</code> to the correct abbreviation and output the corresponding full name.</p>
<p>This works out very well and we got all the names in the right spot, and with the basic timing via <code>tictoc</code> we can see it was still fast. However, there’s a LOT of typing, and more importantly a lot of repetitive typing to get this done.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://github.com/collectivemedia/tictoc'>tictoc</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      team_name <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span> <span class='op'>~</span> <span class='st'>"Cardinals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span> <span class='op'>~</span> <span class='st'>"Falcons"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span> <span class='op'>~</span> <span class='st'>"Ravens"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span> <span class='op'>~</span> <span class='st'>"Bills"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span> <span class='op'>~</span> <span class='st'>"Panthers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span> <span class='op'>~</span> <span class='st'>"Bears"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span> <span class='op'>~</span> <span class='st'>"Bengals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span> <span class='op'>~</span> <span class='st'>"Browns"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span> <span class='op'>~</span> <span class='st'>"Cowboys"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span> <span class='op'>~</span> <span class='st'>"Broncos"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span> <span class='op'>~</span> <span class='st'>"Lions"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> <span class='op'>~</span> <span class='st'>"Packers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span> <span class='op'>~</span> <span class='st'>"Texans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span> <span class='op'>~</span> <span class='st'>"Colts"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span> <span class='op'>~</span> <span class='st'>"Jaguars"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> <span class='op'>~</span> <span class='st'>"Chiefs"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> <span class='op'>~</span> <span class='st'>"Raiders"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span> <span class='op'>~</span> <span class='st'>"Chargers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span> <span class='op'>~</span> <span class='st'>"Rams"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span> <span class='op'>~</span> <span class='st'>"Dolphins"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span> <span class='op'>~</span> <span class='st'>"Vikings"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> <span class='op'>~</span> <span class='st'>"Patriots"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> <span class='op'>~</span> <span class='st'>"Saints"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span> <span class='op'>~</span> <span class='st'>"Giants"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span> <span class='op'>~</span> <span class='st'>"Jets"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span> <span class='op'>~</span> <span class='st'>"Eagles"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span> <span class='op'>~</span> <span class='st'>"Steelers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> <span class='op'>~</span> <span class='st'>"49ers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span> <span class='op'>~</span> <span class='st'>"Seahawks"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> <span class='op'>~</span> <span class='st'>"Buccaneers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span> <span class='op'>~</span> <span class='st'>"Titans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>,
        <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
      <span class='op'>)</span>
    <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 100,000 x 3
   team     stat team_name
   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    
 1 HOU    0.0593 Texans   
 2 JAX   -0.0534 Jaguars  
 3 DEN   -0.0488 Broncos  
 4 NO    -0.0527 Saints   
 5 CAR    0.111  Panthers 
 6 CHI    0.132  Bears    
 7 CAR    0.0481 Panthers 
 8 IND    0.412  Colts    
 9 HOU    0.0425 Texans   
10 ARI    0.200  Cardinals
# … with 99,990 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>0.243 sec elapsed</code></pre>
</div>
<p>We can use a few tricks in RStudio to make this easier!</p>
<p>We’ll use “multiple cursors” in RStudio and combine that with the amazing <a href="https://github.com/MilesMcBain/datapasta"><code>{datapasta}</code></a> package from Miles McBain.</p>
<blockquote>
<p><code>datapasta</code> is about reducing resistance associated with copying and pasting data to and from R. It is a response to the realisation that I often found myself using intermediate programs like Sublime to munge text into suitable formats. Addins and functions in <code>datapasta</code> support a wide variety of input and output situations, so it (probably) “just works”. Hopefully tools in this package will remove such intermediate steps and associated frustrations from our data slinging workflows.</p>
</blockquote>
<aside>
<p><code>datapasta</code> is an absolute life saver for converting objects like vectors/dataframes/clipboard contents and turning them into editable formats in a script.</p>
</aside>
<h3 id="step-1-datapasta">Step 1: <code>datapasta</code></h3>
<p>We’ll first create a character vector via <code>datapasta</code>, using the below code:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>team</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>team</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>datapasta</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/datapasta/man/vector_paste_vertical.html'>vector_paste_vertical</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>I’ve shown a video of me stepping through this code since there are a lot of different options for <code>datapasta</code> and its outputs.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/NH3anI8fPjA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>This gives us a nice starting point of all the vector items and we are ready to work with them in our script.</p>
<h3 id="step-2-multiple-line-selection-in-rstudio">Step 2: Multiple line selection in RStudio</h3>
<p>I’ve done this as a video as it’s fairly complex to “write about”, but very easy to show! The video describes the process of enabling multiple selections in RStudio.</p>
<p>Note that the enabling multi-line selection is done in RStudio via:</p>
<ul>
<li>Opt key + Left Mouse Button drag on Mac<br />
</li>
<li>Alt key + Left Mouse Button drag on Windows</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9OgYTCzPqdE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Once we have this “skeleton” quickly created we can then add the individual “match outputs”, like “Cardinals” for “ARI”, “Falcons” for “ATL”, etc, but we’ve saved ourself the need to type out a lot of the repeated “skeleton” of the <code>case_when()</code>.</p>
<h2 id="a-join-solution">A join solution</h2>
<p>While the above method is pretty quick to create and understand, we still had to type quite a bit (which is decreased if you use multiple cursors), and in many situations a true join is more efficient in terms of typing, “speed of thought”, and execution time.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>team_join</span> <span class='op'>&lt;-</span> <span class='va'>all_teams</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>team_name</span>, team <span class='op'>=</span> <span class='va'>team_short_name</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'>left_join</span><span class='op'>(</span><span class='va'>ex_df</span>, <span class='va'>team_join</span>, by <span class='op'>=</span> <span class='st'>"team"</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 100,000 x 3
   team     stat team_name
   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    
 1 HOU    0.0593 Texans   
 2 JAX   -0.0534 Jaguars  
 3 DEN   -0.0488 Broncos  
 4 NO    -0.0527 Saints   
 5 CAR    0.111  Panthers 
 6 CHI    0.132  Bears    
 7 CAR    0.0481 Panthers 
 8 IND    0.412  Colts    
 9 HOU    0.0425 Texans   
10 ARI    0.200  Cardinals
# … with 99,990 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>0.026 sec elapsed</code></pre>
</div>
<p>Now you may say, well of course I could just use a join if I have a perfect dataset, what do I do with data cleaning?! I would say that a while ago this was a revelation as I typically only would move to key-value pairs + joins when it was obvious, and sometimes I’d end up using a case when solution when a join was easily possible.</p>
<p>So, keep in mind that we can often “create” a joining dataset and use it pretty easily!</p>
<h3 id="tribble"><code>tribble</code></h3>
<p>We can use <a href="https://tibble.tidyverse.org/reference/tribble.html"><code>tribble</code></a> to use almost the <em>exact</em> same setup as the <code>case_when()</code>. We can even use the same multiple cursor workflow to take alter our existing <code>case_when()</code> code and turn it into the below <code>tribble</code> setup.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tribble</span><span class='op'>(</span>
  <span class='op'>~</span><span class='va'>team</span>, <span class='op'>~</span><span class='va'>team_name</span>,
  <span class='st'>"ARI"</span>, <span class='st'>"Cardinals"</span>,
  <span class='st'>"ATL"</span>, <span class='st'>"Falcons"</span>,
  <span class='st'>"BAL"</span>, <span class='st'>"Ravens"</span>,
  <span class='st'>"BUF"</span>, <span class='st'>"Bills"</span>,
  <span class='st'>"CAR"</span>, <span class='st'>"Panthers"</span>,
  <span class='st'>"CHI"</span>, <span class='st'>"Bears"</span>,
  <span class='st'>"CIN"</span>, <span class='st'>"Bengals"</span>,
  <span class='st'>"CLE"</span>, <span class='st'>"Browns"</span>,
  <span class='st'>"DAL"</span>, <span class='st'>"Cowboys"</span>,
  <span class='st'>"DEN"</span>, <span class='st'>"Broncos"</span>,
  <span class='st'>"DET"</span>, <span class='st'>"Lions"</span>,
  <span class='st'>"GB"</span>, <span class='st'>"Packers"</span>,
  <span class='st'>"HOU"</span>, <span class='st'>"Texans"</span>,
  <span class='st'>"IND"</span>, <span class='st'>"Colts"</span>,
  <span class='st'>"JAX"</span>, <span class='st'>"Jaguars"</span>,
  <span class='st'>"KC"</span>, <span class='st'>"Chiefs"</span>,
  <span class='st'>"LV"</span>, <span class='st'>"Raiders"</span>,
  <span class='st'>"LAC"</span>, <span class='st'>"Chargers"</span>,
  <span class='st'>"LAR"</span>, <span class='st'>"Rams"</span>,
  <span class='st'>"MIA"</span>, <span class='st'>"Dolphins"</span>,
  <span class='st'>"MIN"</span>, <span class='st'>"Vikings"</span>,
  <span class='st'>"NE"</span>, <span class='st'>"Patriots"</span>,
  <span class='st'>"NO"</span>, <span class='st'>"Saints"</span>,
  <span class='st'>"NYG"</span>, <span class='st'>"Giants"</span>,
  <span class='st'>"NYJ"</span>, <span class='st'>"Jets"</span>,
  <span class='st'>"PHI"</span>, <span class='st'>"Eagles"</span>,
  <span class='st'>"PIT"</span>, <span class='st'>"Steelers"</span>,
  <span class='st'>"SF"</span>, <span class='st'>"49ers"</span>,
  <span class='st'>"SEA"</span>, <span class='st'>"Seahawks"</span>,
  <span class='st'>"TB"</span>, <span class='st'>"Buccaneers"</span>,
  <span class='st'>"TEN"</span>, <span class='st'>"Titans"</span>,
  <span class='st'>"WSH"</span>, <span class='cn'>NA_character_</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 x 2
   team  team_name
   &lt;chr&gt; &lt;chr&gt;    
 1 ARI   Cardinals
 2 ATL   Falcons  
 3 BAL   Ravens   
 4 BUF   Bills    
 5 CAR   Panthers 
 6 CHI   Bears    
 7 CIN   Bengals  
 8 CLE   Browns   
 9 DAL   Cowboys  
10 DEN   Broncos  
# … with 22 more rows</code></pre>
</div>
<p>You could also just create a more traditional <code>data.frame</code>/<code>tibble</code>, and do the same thing without having to “align” all the rows visually. I <em>do</em> find it a bit easier to look at it row-by-row in the <code>tribble</code> so that I can sanity check myself as I go, but up to the reader to decide!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>distinct</span><span class='op'>(</span><span class='va'>team</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>team</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    team_name <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='st'>"Cardinals"</span>, <span class='st'>"Falcons"</span>, <span class='st'>"Ravens"</span>, <span class='st'>"Bills"</span>, <span class='st'>"Panthers"</span>, <span class='st'>"Bears"</span>, 
        <span class='st'>"Bengals"</span>, <span class='st'>"Browns"</span>, <span class='st'>"Cowboys"</span>, <span class='st'>"Broncos"</span>, <span class='st'>"Lions"</span>, <span class='st'>"Packers"</span>, <span class='st'>"Texans"</span>, 
        <span class='st'>"Colts"</span>, <span class='st'>"Jaguars"</span>, <span class='st'>"Chiefs"</span>, <span class='st'>"Raiders"</span>, <span class='st'>"Chargers"</span>, <span class='st'>"Rams"</span>, <span class='st'>"Dolphins"</span>, 
        <span class='st'>"Vikings"</span>, <span class='st'>"Patriots"</span>, <span class='st'>"Saints"</span>, <span class='st'>"Giants"</span>, <span class='st'>"Jets"</span>, <span class='st'>"Eagles"</span>, <span class='st'>"Steelers"</span>, 
        <span class='st'>"49ers"</span>, <span class='st'>"Seahawks"</span>, <span class='st'>"Buccaneers"</span>, <span class='st'>"Titans"</span>, <span class='cn'>NA_character_</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 x 2
   team  team_name
   &lt;chr&gt; &lt;chr&gt;    
 1 ARI   Cardinals
 2 ATL   Falcons  
 3 BAL   Ravens   
 4 BUF   Bills    
 5 CAR   Panthers 
 6 CHI   Bears    
 7 CIN   Bengals  
 8 CLE   Browns   
 9 DAL   Cowboys  
10 DEN   Broncos  
# … with 22 more rows</code></pre>
</div>
<h2 id="data.tablefcase"><code>data.table::fcase</code></h2>
<p>Now there is also an equivalent function to <code>case_when()</code> in <code>data.table</code> called <a href="https://github.com/Rdatatable/data.table/issues/3823"><code>fcase</code></a> (short for fast case when) as of late 2019. Since it operates on any vector, you can use it as a drop in replacement for most in-memory cases of <code>case_when()</code> in <code>dplyr</code>, or use it in native <code>data.table</code> objects. The expectation is that it will operate similarly in output but be more efficient with regards to memory/time.</p>
<aside>
<p><code>data.table</code> actually provides all sorts of cool optimized functions like this that work anywhere, and you can generally assume a “f” in front of an existing base R function name for the “faster” version of it. See <code>fifelse</code>, <code>rleid</code>, <code>fsetdiff</code> for example.</p>
</aside>
<p>Note, you do <em>not</em> have the ability to push the translation of <code>fcase()</code> into SQL though, as <code>dbplyr</code> only has SQL-translation for <code>case_when()</code>.</p>
<p>The syntax of <code>fcase()</code> and <code>case_when()</code> are <em>essentially</em> the same, but rather than a formula-syntax for assignment via <code>~</code>, it relies on another comma to assign by <strong>position</strong>.</p>
<p>Compare the syntax below:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://Rdatatable.gitlab.io/data.table'>data.table</a></span><span class='op'>)</span>

<span class='va'>mtcars</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>mpg</span>, <span class='va'>cyl</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    cyl_case_when <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
      <span class='co'># relies on `~` to indicate assign</span>
      <span class='co'># read as if cyl is equal to 4 assign "Four"</span>
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>4</span> <span class='op'>~</span> <span class='st'>"Four"</span>,
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span> <span class='op'>~</span> <span class='st'>"Six"</span>,
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>8</span> <span class='op'>~</span> <span class='st'>"Eight"</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
    <span class='op'>)</span>,
    cyl_fcase <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fcase.html'>fcase</a></span><span class='op'>(</span>
      <span class='co'># relies on another `,` to assign by position</span>
      <span class='co'># reas as if cyl is equal to 4, "Four"</span>
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>4</span>, <span class='st'>"Four"</span>,
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>6</span>, <span class='st'>"Six"</span>,
      <span class='va'>cyl</span> <span class='op'>==</span> <span class='fl'>8</span>, <span class='st'>"Eight"</span>,
      <span class='cn'>TRUE</span>, <span class='cn'>NA_character_</span>
    <span class='op'>)</span>,
    cyl_match <span class='op'>=</span> <span class='va'>cyl_case_when</span> <span class='op'>==</span> <span class='va'>cyl_fcase</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 32 x 5
     mpg   cyl cyl_case_when cyl_fcase cyl_match
   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;lgl&gt;    
 1  21       6 Six           Six       TRUE     
 2  21       6 Six           Six       TRUE     
 3  22.8     4 Four          Four      TRUE     
 4  21.4     6 Six           Six       TRUE     
 5  18.7     8 Eight         Eight     TRUE     
 6  18.1     6 Six           Six       TRUE     
 7  14.3     8 Eight         Eight     TRUE     
 8  24.4     4 Four          Four      TRUE     
 9  22.8     4 Four          Four      TRUE     
10  19.2     6 Six           Six       TRUE     
# … with 22 more rows</code></pre>
</div>
<p>Now, I have converted our example with the <code>case_when()</code> statement into <code>fcase()</code> for both <code>dplyr</code> and <code>data.table</code>, but have hidden the code in the detail box below since it’s <em>almost</em> identical and would be quite repetitive. I have printed a test to see if the outcomes are equivalent though between native <code>data.table</code> and <code>dplyr</code>, and they are! 🥳</p>
<p>Really happy to have the option of using some various methods in-memory via <code>fcase()</code> and/or <code>case_when()</code> and optionally if working with REALLY large data push some of that compute into the database via <code>dbplyr</code> + <code>case_when()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>tic</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>dplyr_fcase</span> <span class='op'>&lt;-</span> <span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      team_name <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fcase.html'>fcase</a></span><span class='op'>(</span>
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span>, <span class='st'>"Cardinals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span>, <span class='st'>"Falcons"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span>, <span class='st'>"Ravens"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span>, <span class='st'>"Bills"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span>, <span class='st'>"Panthers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span>, <span class='st'>"Bears"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span>, <span class='st'>"Bengals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span>, <span class='st'>"Browns"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span>, <span class='st'>"Cowboys"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span>, <span class='st'>"Broncos"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span>, <span class='st'>"Lions"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> ,<span class='st'>"Packers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span>, <span class='st'>"Texans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span>, <span class='st'>"Colts"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span>, <span class='st'>"Jaguars"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> ,<span class='st'>"Chiefs"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> ,<span class='st'>"Raiders"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span>, <span class='st'>"Chargers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span>, <span class='st'>"Rams"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span>, <span class='st'>"Dolphins"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span>, <span class='st'>"Vikings"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> ,<span class='st'>"Patriots"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> ,<span class='st'>"Saints"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span>, <span class='st'>"Giants"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span>, <span class='st'>"Jets"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span>, <span class='st'>"Eagles"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span>, <span class='st'>"Steelers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> ,<span class='st'>"49ers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span>, <span class='st'>"Seahawks"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> ,<span class='st'>"Buccaneers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span>, <span class='st'>"Titans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span>, <span class='cn'>NA_character_</span>,
        <span class='cn'>TRUE</span>, <span class='cn'>NA_character_</span>
      <span class='op'>)</span>
    <span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/tictoc/man/tic.html'>toc</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>0.05 sec elapsed</code></pre>
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># data.table native</span>
<span class='va'>dt_fcase</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='va'>ex_df</span><span class='op'>)</span><span class='op'>[</span>, <span class='va'>team_name</span> <span class='op'>:=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fcase.html'>fcase</a></span><span class='op'>(</span>
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span>, <span class='st'>"Cardinals"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span>, <span class='st'>"Falcons"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span>, <span class='st'>"Ravens"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span>, <span class='st'>"Bills"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span>, <span class='st'>"Panthers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span>, <span class='st'>"Bears"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span>, <span class='st'>"Bengals"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span>, <span class='st'>"Browns"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span>, <span class='st'>"Cowboys"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span>, <span class='st'>"Broncos"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span>, <span class='st'>"Lions"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> ,<span class='st'>"Packers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span>, <span class='st'>"Texans"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span>, <span class='st'>"Colts"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span>, <span class='st'>"Jaguars"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> ,<span class='st'>"Chiefs"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> ,<span class='st'>"Raiders"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span>, <span class='st'>"Chargers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span>, <span class='st'>"Rams"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span>, <span class='st'>"Dolphins"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span>, <span class='st'>"Vikings"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> ,<span class='st'>"Patriots"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> ,<span class='st'>"Saints"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span>, <span class='st'>"Giants"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span>, <span class='st'>"Jets"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span>, <span class='st'>"Eagles"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span>, <span class='st'>"Steelers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> ,<span class='st'>"49ers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span>, <span class='st'>"Seahawks"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> ,<span class='st'>"Buccaneers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span>, <span class='st'>"Titans"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span>, <span class='cn'>NA_character_</span>,
    <span class='cn'>TRUE</span>, <span class='cn'>NA_character_</span>
  <span class='op'>)</span><span class='op'>]</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>all_equal</span><span class='op'>(</span><span class='va'>dplyr_fcase</span>, <span class='va'>dt_fcase</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] TRUE</code></pre>
</div>
<h1 id="speed-and-memory">Speed and Memory</h1>
<p>I’m going to preface this by also saying that this is a particular straight forward problem to translate into a <code>join</code>, and it has 32 total comparisons. Most uses of <code>case_when()</code> or <code>fcase()</code> will be more traditional and/or complex logic problems and be much fewer than 30!!!</p>
<p>Now with that being said, you may still say, well I’m not convinced that <code>join()</code> method is any easier or faster to code out for humans, and we’re all free to make our own decisions! I do want to note that <code>case_when()</code> gets memory-inefficient much faster than <code>???_join()</code>.</p>
<p>We can really highlight the differences in the execution time and the memory allocated via the <code>{bench}</code> package. I’m using <code>bench</code> to execute the two different methods 3x time, compare the timing and the memory used, along with some other stats.</p>
<p>In the expandable section below we have a repeat of our above <code>left_join()</code> and <code>case_when()</code> calls.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>join_expr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>ex_df</span>, <span class='va'>team_join</span>, by <span class='op'>=</span> <span class='st'>"team"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>case_when_expr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      team_name <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span> <span class='op'>~</span> <span class='st'>"Cardinals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span> <span class='op'>~</span> <span class='st'>"Falcons"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span> <span class='op'>~</span> <span class='st'>"Ravens"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span> <span class='op'>~</span> <span class='st'>"Bills"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span> <span class='op'>~</span> <span class='st'>"Panthers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span> <span class='op'>~</span> <span class='st'>"Bears"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span> <span class='op'>~</span> <span class='st'>"Bengals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span> <span class='op'>~</span> <span class='st'>"Browns"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span> <span class='op'>~</span> <span class='st'>"Cowboys"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span> <span class='op'>~</span> <span class='st'>"Broncos"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span> <span class='op'>~</span> <span class='st'>"Lions"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> <span class='op'>~</span> <span class='st'>"Packers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span> <span class='op'>~</span> <span class='st'>"Texans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span> <span class='op'>~</span> <span class='st'>"Colts"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span> <span class='op'>~</span> <span class='st'>"Jaguars"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> <span class='op'>~</span> <span class='st'>"Chiefs"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> <span class='op'>~</span> <span class='st'>"Raiders"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span> <span class='op'>~</span> <span class='st'>"Chargers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span> <span class='op'>~</span> <span class='st'>"Rams"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span> <span class='op'>~</span> <span class='st'>"Dolphins"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span> <span class='op'>~</span> <span class='st'>"Vikings"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> <span class='op'>~</span> <span class='st'>"Patriots"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> <span class='op'>~</span> <span class='st'>"Saints"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span> <span class='op'>~</span> <span class='st'>"Giants"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span> <span class='op'>~</span> <span class='st'>"Jets"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span> <span class='op'>~</span> <span class='st'>"Eagles"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span> <span class='op'>~</span> <span class='st'>"Steelers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> <span class='op'>~</span> <span class='st'>"49ers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span> <span class='op'>~</span> <span class='st'>"Seahawks"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> <span class='op'>~</span> <span class='st'>"Buccaneers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span> <span class='op'>~</span> <span class='st'>"Titans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>,
        <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
      <span class='op'>)</span>
    <span class='op'>)</span>
<span class='op'>}</span> 
</code></pre>
</div>
</details>
</div>
<p>We can then compare their execution multiple times with the <code>bench</code> package. This will vary by the execution, but with 3 iterations and 100,000 rows, I have seen about a 10x speed improvement in <code>left_join</code> vs <code>case_when</code>. Note that in most cases this is still pretty much instantaneous in “human time”.</p>
<aside>
<p>Visual reaction time in young adults is in the range of about 250 ms per <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4456887/">Jain et al</a>.</p>
</aside>
<p>However, do note that we use about 28-30 times more memory for the <code>case_when()</code> statement.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>bench</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/bench/man/mark.html'>mark</a></span><span class='op'>(</span>
  min_time <span class='op'>=</span> <span class='fl'>0.1</span>,
  max_iterations <span class='op'>=</span> <span class='fl'>3</span>,
  min_iterations <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='fu'>case_when_expr</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>join_expr</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>expression</span>, <span class='va'>min</span>, <span class='va'>median</span>, <span class='va'>mem_alloc</span>, <span class='va'>n_itr</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 x 4
  expression            min   median mem_alloc
  &lt;bch:expr&gt;       &lt;bch:tm&gt; &lt;bch:tm&gt; &lt;bch:byt&gt;
1 case_when_expr() 154.93ms  217.7ms  150.81MB
2 join_expr()        9.79ms   13.7ms    5.34MB</code></pre>
</div>
<p>The 150 Mb of memory used, may not seem like a lot with smaller datasets (100,000), but if we were to bump this up to 1,000,000 rows we see a similar 10x increase of memory. Specifically we are now up to ~1.5 Gb of memory used for <code>case_when()</code>. So if you’re going beyond the millions or 10s of millions of rows AND are trying to do a LOT of comparisons, probably a good idea to start refactoring into a <code>join</code> if possible!</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># 1,000,000 rows as 1e6</span>
<span class='va'>sample_size</span> <span class='op'>&lt;-</span> <span class='fl'>1e6</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>829</span><span class='op'>)</span>

<span class='va'>ex_df</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span>
  team <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='va'>all_teams</span><span class='op'>$</span><span class='va'>team_short_name</span>, size <span class='op'>=</span> <span class='va'>sample_size</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  stat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>sample_size</span>, mean <span class='op'>=</span> <span class='fl'>0.1</span>, sd <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='fu'>bench</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/bench/man/mark.html'>mark</a></span><span class='op'>(</span>
  min_time <span class='op'>=</span> <span class='fl'>0.1</span>,
  max_iterations <span class='op'>=</span> <span class='fl'>3</span>,
  min_iterations <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='fu'>case_when_expr</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>join_expr</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>expression</span>, <span class='va'>min</span>, <span class='va'>median</span>, <span class='va'>mem_alloc</span>, <span class='va'>n_itr</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 2 x 4
  expression            min   median mem_alloc
  &lt;bch:expr&gt;       &lt;bch:tm&gt; &lt;bch:tm&gt; &lt;bch:byt&gt;
1 case_when_expr()     1.3s    1.36s    1.47GB
2 join_expr()        71.3ms  74.53ms   53.41MB</code></pre>
</div>
<p>There are situations where a <code>join</code> doesn’t solve the problem, so we can go one step further and add in our <code>data.table::fcase()</code> or <code>dtplyr</code>-translation of <code>dplyr</code> into <code>data.table</code>. All the example reprex code is in an expandable chunk below.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidyverse/dtplyr'>dtplyr</a></span><span class='op'>)</span>

<span class='va'>case_when_dplyr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      team_name <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span> <span class='op'>~</span> <span class='st'>"Cardinals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span> <span class='op'>~</span> <span class='st'>"Falcons"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span> <span class='op'>~</span> <span class='st'>"Ravens"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span> <span class='op'>~</span> <span class='st'>"Bills"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span> <span class='op'>~</span> <span class='st'>"Panthers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span> <span class='op'>~</span> <span class='st'>"Bears"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span> <span class='op'>~</span> <span class='st'>"Bengals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span> <span class='op'>~</span> <span class='st'>"Browns"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span> <span class='op'>~</span> <span class='st'>"Cowboys"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span> <span class='op'>~</span> <span class='st'>"Broncos"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span> <span class='op'>~</span> <span class='st'>"Lions"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> <span class='op'>~</span> <span class='st'>"Packers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span> <span class='op'>~</span> <span class='st'>"Texans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span> <span class='op'>~</span> <span class='st'>"Colts"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span> <span class='op'>~</span> <span class='st'>"Jaguars"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> <span class='op'>~</span> <span class='st'>"Chiefs"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> <span class='op'>~</span> <span class='st'>"Raiders"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span> <span class='op'>~</span> <span class='st'>"Chargers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span> <span class='op'>~</span> <span class='st'>"Rams"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span> <span class='op'>~</span> <span class='st'>"Dolphins"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span> <span class='op'>~</span> <span class='st'>"Vikings"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> <span class='op'>~</span> <span class='st'>"Patriots"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> <span class='op'>~</span> <span class='st'>"Saints"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span> <span class='op'>~</span> <span class='st'>"Giants"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span> <span class='op'>~</span> <span class='st'>"Jets"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span> <span class='op'>~</span> <span class='st'>"Eagles"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span> <span class='op'>~</span> <span class='st'>"Steelers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> <span class='op'>~</span> <span class='st'>"49ers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span> <span class='op'>~</span> <span class='st'>"Seahawks"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> <span class='op'>~</span> <span class='st'>"Buccaneers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span> <span class='op'>~</span> <span class='st'>"Titans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>,
        <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
      <span class='op'>)</span>
    <span class='op'>)</span>
<span class='op'>}</span> 


<span class='va'>join_dplyr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>ex_df</span>, <span class='va'>team_join</span>, by <span class='op'>=</span> <span class='st'>"team"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>join_dtplyr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>dt_ex_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dtplyr/man/lazy_dt.html'>lazy_dt</a></span><span class='op'>(</span><span class='va'>ex_df</span><span class='op'>)</span>
  <span class='va'>team_join</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/dtplyr/man/lazy_dt.html'>lazy_dt</a></span><span class='op'>(</span><span class='va'>team_join</span><span class='op'>)</span>
    
  <span class='va'>dt_ex_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>team_join</span>, by <span class='op'>=</span> <span class='st'>"team"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>team</span>, <span class='va'>stat</span>, <span class='va'>team_name</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span> 
<span class='op'>}</span>

<span class='va'>case_when_dtplyr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/pkg/dtplyr/man/lazy_dt.html'>lazy_dt</a></span><span class='op'>(</span><span class='va'>ex_df</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      team_name <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span> <span class='op'>~</span> <span class='st'>"Cardinals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span> <span class='op'>~</span> <span class='st'>"Falcons"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span> <span class='op'>~</span> <span class='st'>"Ravens"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span> <span class='op'>~</span> <span class='st'>"Bills"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span> <span class='op'>~</span> <span class='st'>"Panthers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span> <span class='op'>~</span> <span class='st'>"Bears"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span> <span class='op'>~</span> <span class='st'>"Bengals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span> <span class='op'>~</span> <span class='st'>"Browns"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span> <span class='op'>~</span> <span class='st'>"Cowboys"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span> <span class='op'>~</span> <span class='st'>"Broncos"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span> <span class='op'>~</span> <span class='st'>"Lions"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> <span class='op'>~</span> <span class='st'>"Packers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span> <span class='op'>~</span> <span class='st'>"Texans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span> <span class='op'>~</span> <span class='st'>"Colts"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span> <span class='op'>~</span> <span class='st'>"Jaguars"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> <span class='op'>~</span> <span class='st'>"Chiefs"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> <span class='op'>~</span> <span class='st'>"Raiders"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span> <span class='op'>~</span> <span class='st'>"Chargers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span> <span class='op'>~</span> <span class='st'>"Rams"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span> <span class='op'>~</span> <span class='st'>"Dolphins"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span> <span class='op'>~</span> <span class='st'>"Vikings"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> <span class='op'>~</span> <span class='st'>"Patriots"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> <span class='op'>~</span> <span class='st'>"Saints"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span> <span class='op'>~</span> <span class='st'>"Giants"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span> <span class='op'>~</span> <span class='st'>"Jets"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span> <span class='op'>~</span> <span class='st'>"Eagles"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span> <span class='op'>~</span> <span class='st'>"Steelers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> <span class='op'>~</span> <span class='st'>"49ers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span> <span class='op'>~</span> <span class='st'>"Seahawks"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> <span class='op'>~</span> <span class='st'>"Buccaneers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span> <span class='op'>~</span> <span class='st'>"Titans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>,
        <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span>
      <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>
  
<span class='op'>}</span>

<span class='va'>fcase_dplyr</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>ex_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>
      team_name <span class='op'>=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fcase.html'>fcase</a></span><span class='op'>(</span>
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span>, <span class='st'>"Cardinals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span>, <span class='st'>"Falcons"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span>, <span class='st'>"Ravens"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span>, <span class='st'>"Bills"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span>, <span class='st'>"Panthers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span>, <span class='st'>"Bears"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span>, <span class='st'>"Bengals"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span>, <span class='st'>"Browns"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span>, <span class='st'>"Cowboys"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span>, <span class='st'>"Broncos"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span>, <span class='st'>"Lions"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> ,<span class='st'>"Packers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span>, <span class='st'>"Texans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span>, <span class='st'>"Colts"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span>, <span class='st'>"Jaguars"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> ,<span class='st'>"Chiefs"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> ,<span class='st'>"Raiders"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span>, <span class='st'>"Chargers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span>, <span class='st'>"Rams"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span>, <span class='st'>"Dolphins"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span>, <span class='st'>"Vikings"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> ,<span class='st'>"Patriots"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> ,<span class='st'>"Saints"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span>, <span class='st'>"Giants"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span>, <span class='st'>"Jets"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span>, <span class='st'>"Eagles"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span>, <span class='st'>"Steelers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> ,<span class='st'>"49ers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span>, <span class='st'>"Seahawks"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> ,<span class='st'>"Buccaneers"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span>, <span class='st'>"Titans"</span>,
        <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span>, <span class='cn'>NA_character_</span>
      <span class='op'>)</span>
    <span class='op'>)</span>
<span class='op'>}</span>
  

<span class='va'>fcase_dt_native</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='va'>ex_df</span><span class='op'>)</span><span class='op'>[</span>, <span class='va'>team_name</span> <span class='op'>:=</span> <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fcase.html'>fcase</a></span><span class='op'>(</span>
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ARI"</span>, <span class='st'>"Cardinals"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"ATL"</span>, <span class='st'>"Falcons"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BAL"</span>, <span class='st'>"Ravens"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"BUF"</span>, <span class='st'>"Bills"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CAR"</span>, <span class='st'>"Panthers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CHI"</span>, <span class='st'>"Bears"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CIN"</span>, <span class='st'>"Bengals"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"CLE"</span>, <span class='st'>"Browns"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DAL"</span>, <span class='st'>"Cowboys"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DEN"</span>, <span class='st'>"Broncos"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"DET"</span>, <span class='st'>"Lions"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"GB"</span> ,<span class='st'>"Packers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"HOU"</span>, <span class='st'>"Texans"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"IND"</span>, <span class='st'>"Colts"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"JAX"</span>, <span class='st'>"Jaguars"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"KC"</span> ,<span class='st'>"Chiefs"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LV"</span> ,<span class='st'>"Raiders"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAC"</span>, <span class='st'>"Chargers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"LAR"</span>, <span class='st'>"Rams"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIA"</span>, <span class='st'>"Dolphins"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"MIN"</span>, <span class='st'>"Vikings"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NE"</span> ,<span class='st'>"Patriots"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NO"</span> ,<span class='st'>"Saints"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYG"</span>, <span class='st'>"Giants"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"NYJ"</span>, <span class='st'>"Jets"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PHI"</span>, <span class='st'>"Eagles"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"PIT"</span>, <span class='st'>"Steelers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SF"</span> ,<span class='st'>"49ers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"SEA"</span>, <span class='st'>"Seahawks"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TB"</span> ,<span class='st'>"Buccaneers"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"TEN"</span>, <span class='st'>"Titans"</span>,
    <span class='va'>team</span> <span class='op'>==</span> <span class='st'>"WSH"</span>, <span class='cn'>NA_character_</span>
  <span class='op'>)</span><span class='op'>]</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>join_dt_native</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='va'>ex_df</span><span class='op'>)</span><span class='op'>[</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span><span class='va'>team_join</span><span class='op'>)</span>, on <span class='op'>=</span> <span class='fu'>.</span><span class='op'>(</span><span class='va'>team</span><span class='op'>)</span>, <span class='va'>team_name</span> <span class='op'>:=</span> <span class='va'>team_name</span><span class='op'>]</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>as_tibble</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<p>Finally we can check the timing/memory usage for all of the combos. In short, <code>join()</code>-methods are fastest and use the least memory, <code>fcase()</code> whether in native <code>data.table</code> or <code>dplyr</code> is a bit slower/more memory than <code>join</code> but still ~5x faster/more memory efficient than <code>case_when()</code>, and <code>case_when()</code> is the slowest/most memory hungry (but translates into SQL if needed).</p>
<p>Overall, I’m really happy that we have the ability to mix and match functions from various awesome packages depending on the problems we’re trying to solve!</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>bench</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/bench/man/mark.html'>mark</a></span><span class='op'>(</span>
  min_time <span class='op'>=</span> <span class='fl'>0.1</span>,
  max_iterations <span class='op'>=</span> <span class='fl'>3</span>,
  min_iterations <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='fu'>case_when_dplyr</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>case_when_dtplyr</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>fcase_dplyr</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>fcase_dt_native</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>join_dplyr</span><span class='op'>(</span><span class='op'>)</span>,
  <span class='fu'>join_dt_native</span><span class='op'>(</span><span class='op'>)</span>,
  check <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>expression</span>, <span class='va'>min</span>, <span class='va'>median</span>, <span class='va'>mem_alloc</span>, <span class='va'>n_itr</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 6 x 4
  expression              min   median mem_alloc
  &lt;bch:expr&gt;         &lt;bch:tm&gt; &lt;bch:tm&gt; &lt;bch:byt&gt;
1 case_when_dplyr()     1.46s    1.49s    1.47GB
2 case_when_dtplyr()    1.49s    1.54s    1.51GB
3 fcase_dplyr()      320.37ms 324.42ms  133.75MB
4 fcase_dt_native()  310.85ms 313.07ms  164.42MB
5 join_dplyr()        76.48ms  80.98ms   53.41MB
6 join_dt_native()    76.21ms  87.23ms   61.63MB</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
