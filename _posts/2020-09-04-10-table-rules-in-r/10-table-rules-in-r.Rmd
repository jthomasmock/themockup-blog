---
title: "10+ Guidelines for Better Tables in R"
description: |
  Make tables people ACTUALLY want to read.
author:
  - name: Thomas Mock
base_url: https://themockup.blog
date: 09-04-2020
output: 
  distill::distill_article:
    toc: true
    toc_depth: 3
    self_contained: false
categories:
  - data visualization
  - tables
  - tidyverse
  - tidytuesday
  - gt
preview: preview.png
twitter:
  site: "@thomas_mock"
  creator: "@thomas_mock"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gt)
tuesdata <- tidytuesdayR::tt_load(2020, "36")
```

# Jon Schwabish

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">I recently published &quot;Ten Guidelines for Better Tables&quot; in the Journal of Benefit Cost Analysis (<a href="https://twitter.com/benefitcost?ref_src=twsrc%5Etfw">@benefitcost</a>) on ways to improve your data tables. <br><br>Here&#39;s a thread summarizing the 10 guidelines. <br><br>Full paper is here: <a href="https://t.co/VSGYnfg7iP">https://t.co/VSGYnfg7iP</a> <a href="https://t.co/W6qbsktioL">pic.twitter.com/W6qbsktioL</a></p>&mdash; Jon Schwabish (@jschwabish) <a href="https://twitter.com/jschwabish/status/1290323581881266177?ref_src=twsrc%5Etfw">August 3, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

After seeing Jon's Twitter thread, I asked him if I could adapt the examples over to R. He graciously agreed, so I've gone ahead and adapted some examples from his 10 Guidelines article ^[https://www.cambridge.org/core/journals/journal-of-benefit-cost-analysis/article/ten-guidelines-for-better-tables/74C6FD9FEB12038A52A95B9FBCA05A12] below in the R package [`gt`](https://gt.rstudio.com/). Jon also has a *Better Data Visualizations* book coming out in Jan 2021 - check it out at [Columbia University Press](https://cup.columbia.edu/book/better-data-visualizations/9780231193115).

**10 Rules for Tables**  
- [Twitter Thread](https://twitter.com/jschwabish/status/1290323581881266177)  
- [Journal of Benefit Cost Analysis](https://cambridge.org/core/journals/journal-of-benefit-cost-analysis/article/ten-guidelines-for-better-tables/74C6FD9FEB12038A52A95B9FBCA05A12)  

# Cole Nussbaumer Knaflic

The Storytelling with Data community (`#SWDchallenge`) is hosting a ["Build a Table" challenge](http://www.storytellingwithdata.com/blog/2020/9/1/swdchallenge-build-a-table) for September 2020. Check out the resources below and try your hand to create some beautiful tables!

> Find some data of interest that will lend itself well and create and share a table.  
> Share your creation in the SWD community by September 30th at 5PM PDT. If there is any specific feedback or input that you would find helpful, include that detail in your commentary.  

# Stephen Few

I also have some overview examples from Stephen Few's book [Show Me the Numbers: Designing Tables and Graphs to Enlighten](http://www.stephen-few.com/smtn.php). In my opinion, Stephen Few's *Show Me the Numbers* ^[http://www.stephen-few.com/smtn.php] is one of the best if not *the* best general books on both data visualization and data tables. There are more recent books on data viz, but very few address tables at all, much less with the depth that Few does! I am barely scratching the surface of what Stephen and Jon cover - so make sure to check out their resources!

Few summarizes the difference between Tables and Graphs:  
> **Tables**: Display used to look up and compare individual values  
> **Graphs**: Display used to reveal relationships among whole sets of values and their overall shape  

### When to use each

He further suggests when to use which format:  

```{r few-table, echo = FALSE, layout="l-page"}
tibble(
  `Use Tables When` = c(
    "* The display will be used to look up individual values",
    "* It will be used to compare individual values",
    "* Precise values are required",
    "* Quantitative values include more than one unit of measure",
    "* Both detail and summary values are included"
  ),
  `Use Graphs When` = c(
    "* The display will be used to reveal relationships among whole sets of values",
    "* The message is contained in the shape of the values (e.g., patterns, trends, exceptions)",
    "",
    "",
    ""
  )
) %>% 
  gt() %>% 
  fmt_markdown(everything()) %>% 
  tab_options(
    column_labels.font.weight = "bold"
  ) %>% 
  cols_width(
    1 ~ 300,
    2 ~ 380
  ) %>% 
  tab_options(
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3)
  ) %>% 
  tab_source_note(
    md("Adapted from:<br>Few, Stephen. (2012). *Show Me the Numbers: Designing Tables and Graphs to Enlighten*.(4)57")
  )
```

### Taxonomy of table *uses*

While that's helpful, I also think that his taxonomy of the **Primary Function**, **Relationship Type**, and **Relationship** are extremely useful for determining the purpose of your table. Similar to data viz it's all too easy to simply throw data into a table and not think about how to improve its function. I've adapted his taxonomy and added my own examples with the `#TidyTuesday` dataset from week 36 of 2020.

```{r few-datasets, echo = FALSE, eval = FALSE}
yield_data <- tuesdata$key_crop_yields %>% 
  janitor::clean_names() %>% 
  rename_with(~str_remove(., "_tonnes_per_hectare")) %>% 
  filter(!is.na(code)) %>% 
  select(entity:beans, -code) %>% 
  pivot_longer(cols = wheat:beans, names_to = "crop", values_to = "yield") %>% 
  rename(Country = entity)

few1 <- yield_data %>% 
  filter(crop == "potatoes") %>% 
  filter(
    year == 2017, 
    Country %in% c(
      "Zimbabwe", "Belarus", "Timor", "Chile", "Papua New Guinea")
    ) %>%
  select(Country, `Potato Yield` = yield) %>% 
  gt() %>% 
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 2
    )
  ) %>% 
  tab_style(
    style = cell_borders(
      sides = c("left"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 2,
      columns = 1
    )
  ) %>% 
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 2,
      columns = 2
    )
  ) %>%  
  fmt_number(2) %>% 
  tab_options(
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3)
  )

few1

few2 <- yield_data %>% 
  filter(crop == "potatoes") %>% 
  filter(
    year %in% 2015:2017, 
    Country %in% c(
      "Zimbabwe", "Belarus", "Timor", "Chile", "Papua New Guinea")
    ) %>%
  select(Country, year, Yield = yield) %>% 
  pivot_wider(names_from = year, values_from = "Yield") %>% 
  gt() %>% 
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 2
    )
  ) %>% 
  tab_style(
    style = cell_borders(
      sides = c("left", "right"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      columns = 3
    )
  ) %>% 
  tab_style(
    style = cell_fill(
      color = "lightgrey"
    ),
    locations = cells_body(
      rows = 2,
      columns = 3
    )
  ) %>%  
  fmt_number(2:4) %>% 
  tab_options(
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3)
  )

few2

few3_df <- tuesdata$key_crop_yields %>% 
  janitor::clean_names() %>% 
  rename_with(~str_remove(., "_tonnes_per_hectare")) %>% 
  filter(!is.na(code)) %>% 
  select(entity:beans) %>% 
  pivot_longer(cols = wheat:beans, names_to = "crop", values_to = "yield") %>% 
  rename(Country = entity) %>% 
  filter(crop %in% c("potatoes", "wheat")) %>%
  
  select(Country, code, crop, year, Yield = yield) %>% 
  pivot_wider(names_from = year, values_from = "Yield") %>% 
  mutate(continent = countrycode::countrycode(code, "iso3c", "continent"),
         .before = Country) %>%
  filter(Country %in% c("Denmark", "Ecuador", "Argentina")) %>% 
  arrange(continent, Country, crop) %>% 
  group_by(continent) %>% 
  mutate(row_n = row_number()) %>% 
  mutate(
    crop = str_to_title(crop),
    continent = if_else(row_n == 1, continent, ""),
    Country = if_else(row_n %in% c(1, 3), Country, "")
         ) %>% 
  ungroup() 


few3 <- few3_df %>% 
  select(Continent = continent, Country, Crop = crop, Yield = `2017`) %>% 
  gt() %>% 
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 5
    )
  ) %>% 
  tab_style(
    style = cell_borders(
      sides = "left",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 5,
      columns = 1
    )
  ) %>%  
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 5,
      columns = 4
    )
  ) %>%  
  fmt_number(4) %>% 
  tab_options(
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3)
  )

few3

few4 <- few3_df %>% 
  filter(crop == "Maize") %>% 
  select(Country, `2016`, `2017`, `2018`) %>% 
  gt() %>% 
  tab_style(
    style = cell_borders(
      sides = c("left", "right"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = c(2,3),
      columns = vars(`2017`)
    )
  ) %>%  
  tab_style(
    style = cell_borders(
      sides = c("bottom"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = c(1,3),
      columns = vars(`2017`)
    )
  ) %>% 
  fmt_number(2:4) %>% 
  tab_options(
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3)
  )

few4

few5 <- tuesdata$key_crop_yields %>% 
  janitor::clean_names() %>% 
  rename_with(~str_remove(., "_tonnes_per_hectare")) %>% 
  rename_with(~str_to_title(.)) %>% 
  filter(
    Year == 2017,
    Entity %in% c("Denmark", "Ecuador", "Argentina", "Germany", "United States")
  ) %>% 
  select(Country = Entity, Wheat, Maize, Potatoes) %>% 
  gt() %>% 
  fmt_number(2:4)  %>%  
  tab_style(
    style = cell_borders(
      sides = c("bottom", "top"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = 2,
      columns = 2:4
    )
  ) %>% tab_style(
    style = cell_borders(
      sides = c("right"),
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      rows = c(2),
      columns = c(1,4)
    )
  ) %>% 
  tab_options(
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3)
  )

few5
```


```{r few-examples, layout="l-page", echo = FALSE, eval = FALSE}
tibble(
  `Primary Function` = c("Look-Up", "", "", "Comparison", ""),
  `Relationship Type` = c("Quantitative-to-Categorical", "", "", "Quantitative-to-Quantitative", ""),
  Relationship = c("Between a **single** set of quantitative values and a **single set of categorical items**", 
                   "Between a **single** set of quantitative values and the **intersection of multiple categories**",
                   "Between a **single** set of quantitative values and the **intersection of multiple hierarchical categories**",
                   "Among a **single** set of quantitative values associated with **multiple categorical items**",
                   "Among **distinct** sets of quantitative values associated with a **single categorical item**"),
  Example = glue::glue("https://raw.githubusercontent.com/jthomasmock/radix_themockup/master/static/few{c(1:5)}.png")
  ) %>% 
    gt() %>% 
  fmt_markdown(vars(Relationship)) %>% 
  cols_width(
    vars(`Primary Function`) ~ px(150),
    2 ~ px(150),
    vars(Relationship) ~ 300,
    4 ~ 300
  ) %>% 
  text_transform(
    locations = cells_body(vars(Example)),
    fn = function(x){
      web_image(
        url = x,
        height = px(150)
      )
    }
  ) %>% 
  tab_options(
    table.border.top.color = "white",
    table.border.top.width = px(3),
    column_labels.font.weight = "bold"
  ) %>% 
  tab_source_note(
    md("Adapted from: Few, Stephen. (2012). *Show Me the Numbers: Designing Tables and Graphs to Enlighten* p. 53-58<br>Table Examples: @thomas_mock")
  )

```

```{r, echo = FALSE, fig.dim=c(5,5), layout='l-page'}
knitr::include_graphics("table-table.png")
```


---

# 10 Rules with `gt`

`gt` is again, an R package to create tables in R. It provides a `G`rammar of `T`ables to turn tabular data into a proper table!

![Diagram of the parts of a table](https://gt.rstudio.com/reference/figures/gt_parts_of_a_table.svg)

With this as our starting point, we can use code to add specific portions and change the overall structure and appearance of the tables.

The core data comes from `#TidyTuesday` week 36 of 2020. Let's load up the data and clean it up a bit. We'll be using portions of this data throughout.

```{r load-libs, eval = FALSE}
library(tidyverse)
library(gt)
tuesdata <- tidytuesdayR::tt_load(2020, "36")
```

```{r yield-data}
country_sel <- c("China", "India", "United States", "Indonesia", "Mexico", "Pakistan")

yield_data <- tuesdata$key_crop_yields %>% 
  janitor::clean_names() %>% 
  rename_with(~str_remove(., "_tonnes_per_hectare")) %>% 
  select(entity:beans, -code) %>% 
  pivot_longer(cols = wheat:beans, names_to = "crop", values_to = "yield") %>% 
  rename(Country = entity)
```


## Rule 1: Offset the Heads from the Body

The goal here is to clearly separate your column titles from the body of the table. Typically bold face, separator lines indicate categories/labels (column titles) from values (table body).

First we can prep the data to align with the examples.

```{r rule1-data}
# data prep
potato_data <- yield_data %>% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% c(2013:2016)) %>% 
  filter(crop == "potatoes") %>% 
  pivot_wider(names_from = year, values_from = "yield")
```

### 1. Poor Example

<details>
<summary><strong>Rule 3 | Poor example `gt` code </summary>  

```{r rule1-poor}
potato_tb <- potato_data %>% 
  gt() %>% 
  cols_hide(vars(crop)) %>% 
  opt_table_lines(extent = "none") %>% 
  fmt_number(
    columns = 3:6,
    decimals = 2
  )
```


</details>

```{r}
potato_tb
```

### 1. Improved Example 

<details>
<summary><strong>Rule 1 | Improved `gt` code </summary>  

```{r rule1-good}
rule1_good <- potato_tb %>% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %>% 
  opt_table_lines(extent = "default") %>%
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
  ) %>% 
  tab_source_note("Table: @thomasmock | Data: OurWorldInData.org")
```

</details>

```{r}
rule1_good
```


## Rule 2: Use Subtle Dividers Rather Than Heavy Gridlines

The idea here is that you want to clearly indicate dividers when necessary. Especially with many column labels, you want to make sure that changes in the structure are clear.

```{r rule2-data}
# data prep
rule2_data <- yield_data %>% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% c(2007:2016)) %>% 
  filter(crop == "potatoes") %>% 
  select(-crop) %>% 
  pivot_wider(names_from = year, values_from = "yield") %>% 
  rowwise() %>% 
  mutate(
    avg_07_11 = mean(`2007`:`2011`),
    .before = `2012`
    ) %>% 
  mutate(
    avg_12_16 = mean(`2012`:`2016`)
  ) %>% 
  ungroup()
```

### 2. Poor Example

In this case, while you can probably tell clearly that the bottom row is the Average of each column, did you notice the Avg for 2007-11 and 2012-16?

<details>
<summary><strong>Rule 2 | Poor example `gt` code </summary>  

```{r rule2-poor}
rule2_tab1 <- rule2_data %>% 
  gt() %>% 
  cols_label(
    avg_07_11 = "Avg.",
    avg_12_16 = "Avg."
  ) %>% 
  fmt_number(
    columns = 2:last_col()
  ) %>% 
  tab_style(
    style = cell_borders(
      side = "all",
      color = "grey",
      weight = px(1),
      style = "solid"
    ),
    locations = list(
      cells_body(
        everything()
        ),
      cells_column_labels(
        everything()
      )
      )
  ) %>% 
  grand_summary_rows(
    columns = 2:last_col(),
    fns = list(
      "Average" = ~mean(.)
    ),
    formatter = fmt_number
  )
```

</details>

```{r, layout="l-body-outset"}
rule2_tab1
```

### 2. Improved Example

In this improved example we've clearly indicated the `Avg.` columns. Note that I've also manually calculated a summary row at the bottom, although you could create a `grand_summary_row()` with `gt`. We used that in the previous example.

<details>
<summary><strong>Rule 2 | Improved `gt` code </summary>  

```{r rule2-improved}
rule2_tab2 <- rule2_data %>% 
  add_row(
    rule2_data %>% 
      summarize(
        across(where(is.double), 
               list(Average = mean),
               .names = "{col}")
      ) %>% 
      mutate(Country = "Average")
  ) %>% 
  gt() %>% 
  cols_label(
    avg_07_11 = "Avg.",
    avg_12_16 = "Avg."
  ) %>%
  fmt_number(
    columns = 2:last_col()
  ) %>% 
  tab_style(
    style = cell_fill(
      color = "lightgrey"
    ),
    locations = list(
      cells_body(
        columns = vars(avg_07_11, avg_12_16)
        ),
      cells_column_labels(
        columns = vars(avg_07_11, avg_12_16)
      )
      )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "top",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      columns = everything(),
      rows = Country == "Average"
    )
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %>% 
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black"
  )
```

</details>

```{r}
rule2_tab2 %>% 
  tab_source_note("Table: @thomasmock | Data: OurWorldInData.org")
```


## Rule 3: Right-Align Numbers and Heads

In this case, you want to right align numbers and ideally choose mono-spaced or numerically-aligned fonts, while avoiding "oldstyle" fonts which have numbers with varying vertical placement.

```{r rule3-data}
# Prep data
rule3_data <- yield_data %>% 
  filter(Country == "United States", year %in% c(2016)) %>% 
  mutate(crop = str_to_title(crop)) %>% 
  pivot_wider(names_from = year, values_from = "yield") %>% 
  arrange(crop) %>% 
  select(-Country, Crop = crop)
```

### 3. Comparison of alignment

Notice that left-alignment or center-alignment of numbers impairs the ability to clearly compare numbers and decimal places. Right-alignment lets you align decimal places and numbers for easy parsing.

<details>
<summary><strong>Rule 3 | Alignment `gt` code </summary>  

```{r rule3-align}
rule3_align <- rule3_data %>% 
  mutate(`Center align` = `2016`,
             `Right align` = `2016`) %>%
  rename(`Left align` = 2) %>% 
  gt() %>% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %>% 
  fmt_number(
    columns = 2:4
  ) %>% 
  cols_align(align = "left",
             columns = 2) %>% 
  cols_align(align = "center",
             columns = 3) %>% 
  cols_align(align = "right",
             columns = 4) %>% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
  )
```

</details>

```{r}
rule3_align %>% 
  tab_source_note("Table: @thomasmock | Data: OurWorldInData.org")
```


### 3. Choose fonts carefully

For the fonts below, notice that the Default for `gt` along with a monospaced font in `Fira Mono` have nice alignment of decimal places and equally-spaced numbers. In contrast, `Karla`, `Cabin`, and `Georgia` have issues with alignment of numbers/decimals horizontally and vertically. We've underlined the numbers so you can see the vertical-spacing issues with `Georgia` specifically.

<details>
<summary><strong>Rule 3 | Choosing Fonts `gt` code </summary>  

```{r rule3-fonts}
rule3_text <- rule3_data %>% 
  mutate(Karla = `2016`,
             Cabin = `2016`,
             Georgia = `2016`,
             `Fira Mono` = `2016`) %>%
  rename(Default = 2) %>% 
  gt() %>% 
  tab_style(
    style = list(
      cell_text(font = "Default", decorate = "underline")
    ),
    locations = list(
      cells_column_labels(
        vars(Default)
        ),
      cells_body(
        vars(Default)
      )
  )
  ) %>% 
  tab_style(
    style = list(
      cell_text(font = "Karla", decorate = "underline")
    ),
    locations = list(
      cells_column_labels(
        vars(Karla)
      ),
      cells_body(
        vars(Karla)
      )
    )
  )  %>% 
  tab_style(
    style = list(
      cell_text(font = "Cabin", decorate = "underline")
    ),
    locations = list(
      cells_column_labels(
        vars(Cabin)
      ),
      cells_body(
        vars(Cabin)
      )
    )
  ) %>% 
  tab_style(
    style = list(
      cell_text(font = "Georgia", decorate = "underline")
    ),
    locations = list(
      cells_column_labels(
        vars(Georgia)
      ),
      cells_body(
        vars(Georgia)
      )
    )
  ) %>% 
  tab_style(
    style = list(
      cell_text(font = "Fira Mono", decorate = "underline")
    ),
    locations = list(
      cells_column_labels(
        vars(`Fira Mono`)
      ),
      cells_body(
        vars(`Fira Mono`)
      )
    )
  ) %>% 
  fmt_number(columns = 2:6) %>% 
  tab_spanner(
    label = "Good",
    columns = c(2, 6)
  ) %>% 
  tab_spanner(
    "Bad",
    3:5
  ) %>% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
  )

```

</details>

```{r}
rule3_text %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```


## Rule 4: Left-align Text and Heads

For labels/strings it is typically more appropriate to left-align. This allows your eye to follow both short and long text vertically to scan a table, along with a clear border.

<details>
<summary><strong>Rule 4 | Alignment `gt` code </summary>  

```{r rule4-data}
country_names <- c(
  "British Virgin Islands",
  "Cayman Islands",
  "Democratic Republic of Congo",
  "Luxembourg", 
  "United States",
  "Germany",
  "New Zealand",
  "Costa Rica",
  "Peru"
)

rule4_tab_left <- tibble(
  right = country_names,
  center = country_names,
  left = country_names
) %>% 
  gt()  %>% 
  cols_align(align = "left",
             columns = 3) %>% 
  cols_align(align = "center",
             columns = 2) %>% 
  cols_align(align = "right",
             columns = 1) %>% 
  cols_width(
    everything() ~ px(250)
  ) %>% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.font.weight = "bold",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    data_row.padding = px(3)
  ) %>% 
  cols_label(
    right = md("Right aligned and<br>hard to read"),
    center = md("Centered and<br>even harder to read"),
    left = md("Left-aligned and<br>easiest to read")
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r, layout="l-body-outset"}
rule4_tab_left
```


## Rule 5: Select the Appropriate Level of Precision

While you can sometimes justify increased decimal places, often 1 or 2 can help with the appearance of the table and clean up the overall flow. Additionally, for many measure the accuracy in your dataset may be more detailed than what is appropriate from the data collection tool itself.

<details>
<summary><strong>Rule 5 | Precision `gt` code </summary>  

```{r rule5}
rule5_tab <- yield_data %>% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% c(2016)) %>% 
  select(Country, yield) %>% 
  mutate(few = yield, right = yield) %>% 
  gt() %>% 
  fmt_number(
    columns = vars(few),
    decimals = 0
  ) %>% 
  fmt_number(
    columns = vars(right),
    decimals = 1
  ) %>% 
  cols_label(
    yield = md("Too many<br>decimals"),
    few = md("Too few<br>decimals"),
    right = md("About<br>right")
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))

```

</details>

```{r}
rule5_tab
```

## Rule 6: Guide Your Reader with Space between Rows and Columns

While there is a bit of art to the science of spacing - think of how you want to guide the reader. You want to make it easy to move horizontally and/or vertically depending on the purpose of the table. Additionally, increasing spacing can improve the overall readability of the table although TOO much space can be distracting.

<details>
<summary><strong>Rule 6 | Table Spacing `gt` code </summary>  

```{r rule6}
rule6_data <- yield_data %>% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% c(2014:2016)) %>% 
  filter(crop == "potatoes") %>% 
  pivot_wider(names_from = year, values_from = "yield") %>% 
  select(-crop)

rule6_tb <- rule6_data %>% 
  add_row(
    rule6_data %>% 
      summarize(
        across(where(is.double), 
               list(Average = mean),
               .names = "{col}")
      ) %>% 
      mutate(Country = "Average")
  ) %>% 
  gt() %>% 
  fmt_number(
    columns = 2:4,
    decimals = 2
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %>% 
  tab_style(
    style = cell_borders(
      sides = "top",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      columns = everything(),
      rows = Country == "Average"
    )
  ) %>% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
      ) %>% 
  cols_width(vars(Country) ~ px(125),
             2:4 ~ px(75))
```

</details>

Note that while this table is useful it guides the reader towards vertical comparison within year.

```{r rule6-thin}
rule6_tb %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

Alternatively, this "taller" table pushes the reader towards horizontal tracking of the table.

```{r rule6-tall}
rule6_tb %>% 
  tab_options(data_row.padding = px(20)) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```


## Rule 7: Remove Unit Repetition

The goal here is to remove repetition of units to improve readability and increase the signal to noise ratio in the table. For our example, we are dropping the `%` sign after the first appearance. While this is easy to do with currency symbols at the start of the row, the `%` sign at the end alters the alignment of the cells. `gt` actually has an open [Github Issue](https://github.com/rstudio/gt/issues/606) to allow for this feature, but in the meantime I have two strategies to accomplish the % trick as seen below.

```{r unit-repeat}
rule6_tb %>% 
  fmt_percent(
    columns = 2:4,
    rows = 1,
    scale_values = FALSE
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

We can try to align left for examples that ALL have the same range (ie all in the 10's) as the numbers will align properly, although variation in the units can again mess up the alignment.

```{r unit-left}
rule6_tb %>% 
  fmt_percent(
    columns = 2:4,
    rows = 1,
    scale_values = FALSE
  ) %>% 
  cols_align(
    columns = 2:4,
    align = "left"
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

Alternatively, in some cultures, the `%` sign is placed on the left. We can use this to keep alignment properly although I'll acknowledge this looks awkward to me.

```{r}
rule6_tb %>% 
  fmt_percent(
    columns = 2:4,
    rows = 1,
    scale_values = FALSE,
    placement = "left"
  )  %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```


## Rule 8: Highlight Outliers

With large data tables, it can be useful to take a page from our Data Viz and highlight outliers with color or shape.

```{r rule8-data}
rule8_data <- yield_data %>% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% 2009:2017) %>% 
  group_by(Country) %>% 
  mutate(pct_change = (yield/lag(yield)-1)*100) %>% 
  ungroup() %>% 
  filter(between(year, 2010, 2016)) %>% 
  select(Country, year, pct_change) %>% 
  pivot_wider(names_from = year, values_from = pct_change)
```

The plain data we don't fully recognize the negative values instantly.

<details>
<summary><strong>Rule 8 | Plain table `gt` code </summary>  

```{r rule8-plain}
rule8_tb <- rule8_data %>% 
  gt() %>% 
  fmt_number(2:last_col()) %>% 
  cols_label(
    Country = ""
  ) %>% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %>% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(3),
    table_body.hlines.color = "white",
    table.border.bottom.color = "black",
    table.border.bottom.width = px(3)
  ) %>% 
  cols_width(vars(Country) ~ px(125),
             2:last_col() ~ px(75))
```

</details>

```{r}
rule8_tb %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

However, with a bit of color added we can clearly focus on the outliers.

<details>
<summary><strong>Rule 8 | Text color `gt` code </summary>  

```{r rule8-color}
rule8_color <- rule8_tb %>% 
  tab_style(
    style = cell_text(color = "red"),
    locations = list(
      cells_body(
        columns = 2,
        rows = `2010` < 0
    ),
    cells_body(
      columns = 3,
      rows = `2011` < 0
    ),
    cells_body(
      columns = 4,
      rows = `2012` < 0
    ),
    cells_body(
      columns = 5,
      rows = `2013` < 0
    ),
    cells_body(
      columns = 6,
      rows = `2014` < 0
    ),
    cells_body(
      columns = 7,
      rows = `2015` < 0
    ),
    cells_body(
      columns = 8,
      rows = `2016` < 0
    )
  )
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r}
rule8_color
```

We can *really* pull the focus with background fill of each cell outlier.

<details>
<summary><strong>Rule 8 | Cell fill `gt` code </summary>  

```{r rule8-fill}
rule8_fill <- rule8_tb %>% 
  tab_style(
    style = list(
      cell_fill(color = scales::alpha("red", 0.7)),
      cell_text(color = "white", weight = "bold")
      ),
    locations = list(
      cells_body(
        columns = 2,
        rows = `2010` < 0
      ),
      cells_body(
        columns = 3,
        rows = `2011` < 0
      ),
      cells_body(
        columns = 4,
        rows = `2012` < 0
      ),
      cells_body(
        columns = 5,
        rows = `2013` < 0
      ),
      cells_body(
        columns = 6,
        rows = `2014` < 0
      ),
      cells_body(
        columns = 7,
        rows = `2015` < 0
      ),
      cells_body(
        columns = 8,
        rows = `2016` < 0
      )
    )
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
  
```

</details>

```{r}
rule8_fill
```


## Rule 9: Group Similar Data and Increase White Space

In this rule, you want to make sure to group similar categories to make parsing the table easier. We can also increase white space, or even remove repeats to increase the data-to-ink ratio.

```{r rule9-data}
rule9_data <- yield_data %>% 
  filter(Country %in% country_sel[-5], year %in% c(2015, 2016),
         crop %in% c("wheat", "potatoes", "rice", "soybeans"),
         !is.na(yield)) %>% 
  pivot_wider(names_from = year, values_from = yield) %>% 
  rowwise() %>% 
  mutate(crop = str_to_title(crop),
         pct_change = (`2016`/`2015`-1)*100) %>%
  group_by(Country) %>% 
  arrange(desc(`2015`)) %>% 
  ungroup() 
```

### 9. Bad Example

Here we can see the table is a bit hard to follow with the Country labels not being grouped.

<details>
<summary><strong>Rule 9 | Bad example `gt` code </summary>  

```{r rule9-tb}
rule9_bad <- rule9_data %>% 
  gt() %>% 
  fmt_number(
    columns = vars(`2015`, `2016`, pct_change)
  ) %>% 
  tab_spanner(columns = vars(`2015`, `2016`),
              label = md("**Yield in Tonnes/Hectare**")) %>%  
  cols_width(
    vars(crop) ~ px(125),
    vars(`2015`, `2016`, pct_change) ~ 100
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```
  
</details>

```{r}
rule9_bad
```


### 9. `gt` native grouping

`gt` provides row group levels that we can use to separate by Country.

<details>
<summary><strong>Rule 9 | Groups `gt` code </summary>
  
```{r rule9-groups}
rule9_grp <- rule9_data %>% 
  gt(groupname_col = "Country") %>% 
  tab_stubhead("label") %>% 
  tab_options(
    table.width = px(300)
  ) %>% 
  cols_label(
    crop = "",
    pct_change = md("Percent<br>Change")
  ) %>% 
  fmt_number(
    columns = vars(`2015`, `2016`, pct_change)
  ) %>% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_row_groups(),
      cells_column_labels(everything())
    )
  ) %>% 
  tab_spanner(columns = vars(`2015`, `2016`),
              label = md("**Yield in Tonnes/Hectare**")) %>%  
  cols_width(
    vars(crop) ~ px(125),
    vars(`2015`, `2016`, pct_change) ~ 100
  ) %>% 
  tab_options(
    row_group.border.top.width = px(3),
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(2),
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r}
rule9_grp
```


### 9. Remove duplicate data

Alternatively, we can remove some observations to create more white space, similar to Jon's example. Here we are relying purely on white space rather than horizontal dividers.

<details>
<summary><strong>Rule 9 | Group example `gt` code </summary>

```{r rule9-duplicate}
rule9_dup <- rule9_data %>% 
  group_by(Country) %>% 
  arrange(Country, desc(`2015`)) %>% 
  mutate(row_n = row_number()) %>% 
  ungroup() %>% 
  mutate(Country = if_else(row_n > 1, "", Country)) %>% 
  select(-row_n) %>% 
  gt() %>% 
  cols_label(
    Country = "",
    crop = "Crop",
    pct_change = md("Percent<br>Change")
  ) %>% 
  tab_spanner(columns = vars(`2015`, `2016`),
              label = md("**Yield in Tonnes/Hectare**")) %>% 
  fmt_number(
    columns = vars(`2015`, `2016`, pct_change)
  ) %>% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_row_groups(),
      cells_column_labels(everything())
    )
  ) %>% 
  cols_width(
    vars(Country, crop) ~ px(125),
    vars(`2015`, `2016`, pct_change) ~ 100
  ) %>% 
  tab_options(
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(2),
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))

```

</details>

```{r}
rule9_dup
```


## Rule 10: Add visualizations When Appropriate

While data viz and tables are different tools, you can combine them in clever ways to further engage the reader. Embedded data viz can reveal trends, while the table itself shows the raw data for lookup.

```{r rule10-data}
rule10_data <- yield_data %>% 
  filter(
    year %in% c(2013,2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
      )
    ) %>% 
  pivot_wider(names_from = year, values_from = yield)

```

### 10. Sparklines

For example one we can use sparklines to indicate trends across time. There's quite a bit of code below, and we actually use two datasets. Since we are creating the sparklines outside of `gt` make sure to align the graphs + data as `gt` doesn't control the overall relationship. For example, if you `arrange()` by a specific column you'll need to make sure to do it across both datasets.

<details>
<summary><strong>Rule 10 | Sparkline example `gt` code </summary>

```{r rule10-spark}
plot_spark <- function(data){
  data %>% 
    mutate(
      yield_start = if_else(year == 2013, yield, NA_real_),
      yield_end = if_else(year == 2017, yield, NA_real_)
    ) %>% 
    tidyr::fill(yield_start, yield_end, .direction = "downup") %>% 
    mutate(color = if_else(yield_end-yield_start < 0, "red", "blue")) %>% 
    ggplot(aes(x = year, y = yield, color = color)) +
    geom_line(size = 15) +
    theme_void() +
    scale_color_identity() +
    theme(legend.position = "none")
}

# SPARKLINE

yield_plots <- yield_data %>% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %>% 
  nest(yields = c(year, yield)) %>% 
  mutate(plot = map(yields, plot_spark))

# SPARKLINES PLOT

rule10_spark <- rule10_data %>% 
  mutate(ggplot = NA) %>% 
  select(-crop) %>% 
  gt() %>% 
  text_transform(
    locations = cells_body(vars(ggplot)),
    fn = function(x){
      map(yield_plots$plot, ggplot_image, height = px(15), aspect_ratio = 4)
    }
  ) %>% 
  cols_width(vars(ggplot) ~ px(100)) %>% 
  cols_label(
    ggplot = "2013-2017"
  ) %>% 
  fmt_number(2:3) %>% 
  tab_spanner(
    label = "Potato Yield in Tonnes/Hectare",
    columns = c(2,3)
  ) %>% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_spanners(everything()),
      cells_column_labels(everything())
    )
  ) %>%  
  tab_options(
    row_group.border.top.width = px(3),
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(2),
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r}
rule10_spark
```


### 10. Barplot

For example one we can use barplots to indicate the average across the 5 years. There's quite a bit of code below, and we actually use two datasets. Since we are creating the sparklines outside of `gt` make sure to align the graphs + data as `gt` doesn't control the overall relationship. For example, if you `arrange()` by a specific column you'll need to make sure to do it across both datasets.

<details>
<summary><strong>Rule 10 | Barplot example `gt` code </summary>

```{r rule10-barplot}
plot_bar <- function(data){

  data_range <- yield_data %>%
  filter(
    year %in% c(2013:2017),
    crop == "potatoes",
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy",
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %>%
  pull(yield) %>%
  range()
  
  yield_mean <- data %>% 
    summarize(yield = mean(yield))
  
  
col_pal <-  scales::col_numeric(as.character(paletteer::paletteer_d("ggsci::blue_material", n = 9)), 
                                domain = data_range)(pull(yield_mean, yield))
  
    yield_mean %>% 
    ggplot() +
    geom_col(aes(x = 1, y = yield), size = 5,
             fill = col_pal, color = col_pal, width = 0.7) +
    coord_flip() +
    theme_void() +
      scale_y_continuous(limits = c(0, data_range[2])) +
    theme(legend.position = "none")
}


# BARPLOT

bar_yields <- yield_data %>% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %>% 
  nest(yields = c(year, yield)) %>% 
  mutate(plot = map(yields, plot_bar))
  
# BARPLOT

rule10_bar <- rule10_data %>% 
  select(-crop) %>% 
  rowwise() %>% 
  mutate(mean = mean(`2013`:`2017`),
         ggplot = NA) %>% 
  gt() %>% 
  text_transform(
    locations = cells_body(vars(ggplot)),
    fn = function(x){
      map(bar_yields$plot, ggplot_image, height = px(15), aspect_ratio = 4)
    }
  ) %>%
  cols_width(vars(ggplot) ~ px(100),
             vars(`2013`) ~ px(75),
             vars(`2017`) ~ px(75)
             ) %>% 
  cols_label(
    mean = md("Average<br>2013-17"),
    ggplot = ""
  ) %>% 
  cols_align(
    align = "right",
    columns = 2:4
  ) %>% 
  fmt_number(2:4) %>% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_labels(everything())
    )
  ) %>%  
  tab_options(
    row_group.border.top.width = px(3),
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    table_body.border.bottom.width = px(2),
    table_body.border.bottom.color = "black",
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(3)
  ) %>% 
  tab_footnote(footnote = "Potato Yield in Tonnes per Hectare",
               locations = cells_column_labels(
                 columns =2:4
               )) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r}
rule10_bar
```


### 10. Heatmap

Lastly, you can add colors across the entire plot itself to show trends across the data over time and across country.

<details>
<summary><strong>Rule 10 | Heatmap example `gt` code </summary>

```{r rule10-heatmap}
rule10_wide <- yield_data %>% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %>% 
  pivot_wider(names_from = year, values_from = yield)

rule10_heat <- rule10_wide %>% 
  arrange(desc(`2013`)) %>% 
  select(-crop) %>% 
  gt() %>% 
  data_color(
    columns = 2:6, 
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(
        palette = "ggsci::blue_material"
      ) %>% as.character(),
      domain = NULL
    )
  ) %>% 
  fmt_number(2:6) %>% 
  tab_spanner(
    label = "Potato Yield in Tonnes/Hectare",
    columns = c(2:6)
  ) %>% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_spanners(everything()),
      cells_column_labels(everything())
    )
  ) %>%  
  cols_width(
    2:6 ~ px(65)
  ) %>% 
  tab_options(
    row_group.border.top.width = px(3),
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(2),
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r}
rule10_heat
```


### 10. Percent Change

Ok I lied! One more example, with color for a numeric column.

<details>
<summary><strong>Rule 10 | Percent change example `gt` code </summary>

```{r rule10-wide-pct}
rule10_wide <- yield_data %>% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %>% 
  pivot_wider(names_from = year, values_from = yield)

rule10_pct <- rule10_wide %>% 
  arrange(Country) %>% 
  select(-crop) %>% 
  mutate(pct_change = (`2017`/`2013`-1)*100) %>% 
  gt()%>% 
  fmt_number(2:7) %>% 
  cols_label(
    pct_change = md("% Change<br>2013-2017")
  ) %>% 
  tab_style(
    style = list(
      cell_text(color = "red")
    ),
    locations = cells_body(
      columns = vars(pct_change),
      rows = `2017` < `2013`
    )
  ) %>% 
  tab_style(
    style = list(
      cell_text(color = "blue")
    ),
    locations = cells_body(
      columns = vars(pct_change),
      rows = `2017` > `2013`
    )
  ) %>% 
  tab_spanner(
    label = "Potato Yield in Tonnes/Hectare",
    columns = c(2:6)
  ) %>% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_spanners(everything()),
      cells_column_labels(everything())
    )
  ) %>%  
  tab_options(
    row_group.border.top.width = px(3),
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(2),
  ) %>% 
  tab_source_note(md("**Table**: @thomasmock | **Data**: OurWorldInData.org<br>**Inspiration**: @jschwabish"))
```

</details>

```{r}
rule10_pct
```



