<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Beautiful Tables in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Tom Mock" />
    <meta name="date" content="2021-08-30" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link rel="stylesheet" href="xaringan-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <span style="color:#fcab27">Beautiful Tables in R</span>
## <span style="color:#3686d3">gt and the grammar of tables</span> <br>
### <a href = 'https://twitter.com/thomas_mock'><span style="color:#ff2b4f">Tom Mock</span></a>
### 2021-08-30

---





layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;cmsac-tidymodels.netlify.app/&lt;/span&gt;&lt;/div&gt;

---

### Tables with R

Construct a wide variety of useful tables with a cohesive set of table parts. These include the *table header*, the *stub*, the *column labels* and *spanner column labels*, the *table body* and the *table footer*.

--

![](https://gt.rstudio.com/reference/figures/gt_parts_of_a_table.svg)
---

![](https://gt.rstudio.com/reference/figures/gt_workflow_diagram.svg)
--
.pull-left[

```r
mtcars %&gt;% 
  select(cyl:wt) %&gt;% 
  head() %&gt;% 
  gt() 
```

]

--

.pull-right[
<table style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;">
  
  <thead style="border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
    <tr>
      <th style="color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;" rowspan="1" colspan="1">cyl</th>
      <th style="color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;" rowspan="1" colspan="1">disp</th>
      <th style="color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;" rowspan="1" colspan="1">hp</th>
      <th style="color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;" rowspan="1" colspan="1">drat</th>
      <th style="color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;" rowspan="1" colspan="1">wt</th>
    </tr>
  </thead>
  <tbody style="border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
    <tr><td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">6</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">160</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">110</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.90</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">2.620</td></tr>
    <tr><td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">6</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">160</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">110</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.90</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">2.875</td></tr>
    <tr><td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">4</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">108</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">93</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.85</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">2.320</td></tr>
    <tr><td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">6</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">258</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">110</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.08</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.215</td></tr>
    <tr><td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">8</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">360</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">175</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.15</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.440</td></tr>
    <tr><td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">6</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">225</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">105</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">2.76</td>
<td style="padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: right; font-variant-numeric: tabular-nums;">3.460</td></tr>
  </tbody>
  
  
</table>

]


---



&lt;img src="tables/few-table-rule.png" width="100%" style="display: block; margin: auto;" /&gt;



---



&lt;img src="tables/few-table-ex.png" width="70%" style="display: block; margin: auto;" /&gt;


---

### `#TidyTuesday` data


```r
library(tidyverse)
library(gt)

url_in &lt;- 'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-01/key_crop_yields.csv'

raw_yields &lt;- readr::read_csv(url_in)

yield_data &lt;- raw_yields %&gt;% 
  janitor::clean_names() %&gt;% 
  rename_with(~str_remove(., "_tonnes_per_hectare")) %&gt;% 
  select(entity:beans, -code) %&gt;% 
  pivot_longer(cols = wheat:beans, names_to = "crop", values_to = "yield") %&gt;% 
  rename(Country = entity)

yield_data
```

```
## # A tibble: 78,450 × 4
##    Country      year crop      yield
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 Afghanistan  1961 wheat     1.02 
##  2 Afghanistan  1961 rice      1.52 
##  3 Afghanistan  1961 maize     1.4  
##  4 Afghanistan  1961 soybeans NA    
##  5 Afghanistan  1961 potatoes  8.67 
##  6 Afghanistan  1961 beans    NA    
##  7 Afghanistan  1962 wheat     0.974
##  8 Afghanistan  1962 rice      1.52 
##  9 Afghanistan  1962 maize     1.4  
## 10 Afghanistan  1962 soybeans NA    
## # … with 78,440 more rows
```


---

### `#TidyTuesday` data



```r
country_sel &lt;- c(
  "China", "India", "United States", 
  "Indonesia", "Mexico", "Pakistan"
  )

yield_data_wide &lt;- raw_yields %&gt;% 
  janitor::clean_names() %&gt;% 
  rename_with(
    ~str_remove(., "_tonnes_per_hectare")
    ) %&gt;% 
  select(entity:beans, -code) %&gt;% 
  pivot_longer(
    cols = wheat:beans, 
    names_to = "crop", 
    values_to = "yield"
    ) %&gt;% 
  rename(Country = entity) %&gt;% 
  filter(
    crop %in% c("potatoes", "maize"), 
    year %in% c(2014:2016),
    Country %in% country_sel
    ) %&gt;% 
  pivot_wider(
    names_from = year, 
    values_from = yield
    )
```


---

### `#TidyTuesday` data


```r
yield_data_wide
```

```
## # A tibble: 12 × 5
##    Country       crop     `2014` `2015` `2016`
##    &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 China         maize      5.81   5.89   5.97
##  2 China         potatoes  17.1   17.3   17.7 
##  3 India         maize      2.61   2.60   2.62
##  4 India         potatoes  22.9   23.1   20.5 
##  5 Indonesia     maize      4.95   5.18   5.31
##  6 Indonesia     potatoes  17.7   18.2   18.3 
##  7 Mexico        maize      3.30   3.48   3.72
##  8 Mexico        potatoes  27.3   27.1   27.9 
##  9 Pakistan      maize      4.32   4.42   4.55
## 10 Pakistan      potatoes  18.2   23.4   22.4 
## 11 United States maize     10.7   10.6   11.7 
## 12 United States potatoes  47.2   46.9   48.6
```

---

### Basic `gt` table


```r
yield_data_wide %&gt;% 
  gt()
```

--

&lt;img src="tables/basic-gt.png" width="40%" style="display: block; margin: auto;" /&gt;


---

### Add groups

.pull-left[

```r
yield_data_wide %&gt;% 
  head() %&gt;% 
  # respects grouping from dplyr
* group_by(Country) %&gt;%
  gt(rowname_col = "crop") 
```

&lt;img src="tables/group-tab.png" width="65%" style="display: block; margin: auto;" /&gt;


]


--

.pull-right[

```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
*   groupname_col = "crop",
*   rowname_col = "Country"
  ) 
```

&lt;img src="tables/group-tab.png" width="65%" style="display: block; margin: auto;" /&gt;

]


---



.pull-left[
### Groups


```r
yield_data_wide %&gt;% 
  mutate(crop = str_to_title(crop)) %&gt;% 
  group_by(crop) %&gt;% 
  gt(
    rowname_col = "Country"
  ) %&gt;% 
  fmt_number(
    columns = 2:5, # reference cols by pos
    decimals = 2 # decrease decimal places
    ) %&gt;% 
* summary_rows(
*   groups = TRUE,
    # reference cols by name
    columns = c(`2014`, `2015`, `2016`), 
    fns = list(
      # add summary stats
*     avg = ~mean(.),
*     sd = ~sd(.)
    )
  )
```

]

--

.pull-right[
&lt;img src="tables/group-sum.png" width="60%" style="display: block; margin: auto;" /&gt;

]

---

### Add spanners

Table spanners can be added quickly with `tab_spanner()` and again use either position (column number) or with `tidyeval` by name.

.pull-left[

```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;% 
* tab_spanner(
*   label = "Yield in Tonnes/Hectare",
*   columns = 2:5
    ) 
```

]

--

.pull-right[
&lt;img src="tables/tab-spanner.png" width="70%" style="display: block; margin: auto;" /&gt;

]

---

### Add notes and titles

Footnotes can be added with `tab_footnote()`. Note that this is our first use of the `locations` argument. Locations is used with things like `cells_column_labels()` or `cells_body()`, `cells_summary()` to offer very tight control of where to place certain changes. 

.pull-left[

```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;% 
  tab_footnote(
    footnote = "Yield in Tonnes/Hectare", 
*   locations = cells_column_labels(
      columns = 1:3
      )
    )
```

]

--

.pull-right[
&lt;img src="tables/footnote-tab.png" width="65%" style="display: block; margin: auto;" /&gt;

]

---

### Add notes and titles

Footnotes can be added with `tab_footnote()`. Note that this is our first use of the `locations` argument. Locations is used with things like `cells_column_labels()` or `cells_body()`, `cells_summary()` to offer very tight control of where to place certain changes. 

.pull-left[

```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;% 
  tab_footnote(
    footnote = "Yield in Tonnes/Hectare", 
    locations = cells_column_labels(
      columns = 1:3 # note
      )
    ) %&gt;% 
  # Adding a `source_note()`
  tab_source_note(
*   source_note = "Data: OurWorldInData"
    )
```

]

--

.pull-right[
&lt;img src="tables/source-note-tab.png" width="65%" style="display: block; margin: auto;" /&gt;

]


---

### Add Title/Subtitle

Adding a title or subtitle with `tab_header()` and notice that I used `md()` around the title and `html()` around subtitle to adjust their appearance. 

.pull-left[

```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;%
  tab_header(
    title = md("**Crop Yields between 2014 and 2016**"),
    subtitle = html("&lt;em&gt;Countries limited to Asia&lt;/em&gt;")
  )
```

]

--

.pull-right[
&lt;img src="tables/title-tab.png" width="70%" style="display: block; margin: auto;" /&gt;

]

---

### Adjust appearance

You can customize large chunks of the table appearance all at once via `tab_options()`. The full reference to ALL the options you can customize are in the [`gt` packagedown site](https://gt.rstudio.com/reference/tab_options.html).

.pull-left[

```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;%
  tab_header(
    title = "Crop Yields between 2014 and 2016",
    subtitle = "Countries limited to Asia"
  ) %&gt;% 
* tab_options(
    heading.subtitle.font.size = 12,
    heading.align = "left",
    table.border.top.color = "red",
    column_labels.border.bottom.color = "red",
    column_labels.border.bottom.width= px(3)
  )
```

]

--

.pull-right[
&lt;img src="tables/theme-tab.png" width="70%" style="display: block; margin: auto;" /&gt;

]

---

### Pseudo-themes

Because `gt` is built up by a series of piped examples, you can also pass along additional changes/customization as a function almost like a `ggplot2` theme!

.pull-left[

```r
my_theme &lt;- function(data) {
  tab_options(
    data = data,
    heading.subtitle.font.size = 12,
    heading.align = "left",
    table.border.top.color = "red",
    column_labels.border.bottom.color = "red",
    column_labels.border.bottom.width= px(3)
  )
}
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;%
  tab_header(
    title = "Crop Yields between 2014 and 2016",
    subtitle = "Countries limited to Asia"
  ) %&gt;% 
  my_theme()
```
]

--

.pull-right[
&lt;img src="tables/theme-tab.png" width="70%" style="display: block; margin: auto;" /&gt;

]

---

### Style specific cells w/ `tab_style()`

.pull-left[
.small[


```r
yield_data_wide %&gt;% 
  head() %&gt;%
  gt() %&gt;% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %&gt;% 
  tab_style(
    style = list(
      cell_fill(color = "black", alpha = 0.2),
      cell_borders(
        side = c("left", "right"), 
        color = "black",
        weight = px(2)
        )
      ),
    locations = cells_body(
      columns = crop
      )
  ) %&gt;% 
  tab_style(
    style = list(
      cell_text(color = "red", style = "italic")
    ),
    locations = cells_body(
      columns = 3:5,
      rows = Country == "China"
    )
  )
```

]

]

--

.pull-right[
&lt;img src="tables/tab-style.png" width="75%" style="display: block; margin: auto;" /&gt;

]

---

### Color Gradient


.pull-left[

```r
my_pal &lt;- scales::col_numeric(
  paletteer::paletteer_d(
    palette = "ggsci::red_material"
    ) %&gt;% as.character(),
  domain = NULL
  )
  
yield_data_wide %&gt;% 
  head() %&gt;%
  gt(
    groupname_col = "crop",
    rowname_col = "Country"
  ) %&gt;% 
  data_color(
    columns = c(`2014`, `2015`, `2016`),
    colors = my_pal
      )
```

]

--

.pull-right[
&lt;img src="tables/color-gradient.png" width="75%" style="display: block; margin: auto;" /&gt;

]

---
class:inverse, center, middle

# 10 Guidelines with `gt`

---

### Original Credit

&lt;blockquote class="twitter-tweet"&gt;&lt;p lang="en" dir="ltr"&gt;I recently published &amp;quot;Ten Guidelines for Better Tables&amp;quot; in the Journal of Benefit Cost Analysis (&lt;a href="https://twitter.com/benefitcost?ref_src=twsrc%5Etfw"&gt;@benefitcost&lt;/a&gt;) on ways to improve your data tables. &lt;br&gt;&lt;br&gt;Here&amp;#39;s a thread summarizing the 10 guidelines. &lt;br&gt;&lt;br&gt;Full paper is here: &lt;a href="https://t.co/VSGYnfg7iP"&gt;https://t.co/VSGYnfg7iP&lt;/a&gt; &lt;a href="https://t.co/W6qbsktioL"&gt;pic.twitter.com/W6qbsktioL&lt;/a&gt;&lt;/p&gt;&amp;mdash; Jon Schwabish (@jschwabish) &lt;a href="https://twitter.com/jschwabish/status/1290323581881266177?ref_src=twsrc%5Etfw"&gt;August 3, 2020&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;

---

### Rule 1: Offset the Heads from the Body


```r
# data prep
potato_data &lt;- yield_data %&gt;% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% c(2013:2016)) %&gt;% 
  filter(crop == "potatoes") %&gt;% 
  pivot_wider(names_from = year, values_from = "yield")

potato_data
```

```
## # A tibble: 6 × 6
##   Country       crop     `2013` `2014` `2015` `2016`
##   &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 China         potatoes   17.1   17.1   17.3   17.7
## 2 India         potatoes   22.8   22.9   23.1   20.5
## 3 Indonesia     potatoes   16.0   17.7   18.2   18.3
## 4 Mexico        potatoes   26.8   27.3   27.1   27.9
## 5 Pakistan      potatoes   21.8   18.2   23.4   22.4
## 6 United States potatoes   46.4   47.2   46.9   48.6
```

---

### Rule 1: Offset the Heads from the Body

.panelset[
.panel[.panel-name[Bad Table]

&lt;img src="tables/potato-tab.png" width="60%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Good Table]
&lt;img src="tables/hot-potato.png" width="60%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Bad Code]

```r
potato_tb &lt;- potato_data %&gt;% 
  gt() %&gt;% 
  cols_hide(c(crop)) %&gt;% 
  opt_table_lines(extent = "none") %&gt;% 
  fmt_number(
    columns = 3:6,
    decimals = 2
  )
```

]

.panel[.panel-name[Good Code]

```r
hot_potato &lt;- potato_tb %&gt;% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %&gt;% 
  opt_table_lines(extent = "default") %&gt;%
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
  ) %&gt;% tab_source_note(
    md(
      "**Table**: @thomas_mock |
       **Data**: OurWorldInData.org
      &lt;br&gt;**Inspiration**: @jschwabish"
      )
    )
```

]
]

---

### Rule 2: Use Subtle Dividers Rather Than Heavy Gridlines

The idea here is that you want to clearly indicate dividers when necessary. Especially with many column labels, you want to make sure that changes in the structure are clear.


```r
# data prep
rule2_data &lt;- yield_data %&gt;% 
  filter(Country %in% country_sel, crop == "potatoes", year %in% c(2007:2016)) %&gt;% 
  filter(crop == "potatoes") %&gt;% 
  select(-crop) %&gt;% 
  pivot_wider(names_from = year, values_from = "yield") %&gt;% 
  rowwise() %&gt;% 
  mutate(
    avg_07_11 = mean(`2007`:`2011`),
    .before = `2012`
    ) %&gt;% 
  mutate(
    avg_12_16 = mean(`2012`:`2016`)
  ) %&gt;% 
  ungroup()
```

---

### Rule 2: Use Subtle Dividers Rather Than Heavy Gridlines

.panelset[
.panel[.panel-name[Bad Table]

&lt;img src="tables/rule2-tab1.png" width="75%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Good Table]
&lt;img src="tables/rule2-tab2.png" width="75%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Bad Code]
.small[

```r
rule2_tab1 &lt;- rule2_data %&gt;% 
  gt(
    rowname_col = "Country"
  ) %&gt;% 
  cols_label(
    avg_07_11 = "Avg.",
    avg_12_16 = "Avg."
  ) %&gt;% 
  cols_width(
    1 ~ px(125)
  ) %&gt;% 
  fmt_number(
    columns = 2:last_col()
  ) %&gt;% 
  tab_style(
    style = cell_borders(
      side = "all",
      color = "grey",
      weight = px(1),
      style = "solid"
    ),
    locations = list(
      cells_body(
        everything()
        ),
      cells_column_labels(
        everything()
      )
      )
  ) %&gt;% 
  grand_summary_rows(
    columns = 2:last_col(),
    fns = list(
      "Average" = ~mean(.)
    ),
    formatter = fmt_number
  )
```
]

]

.panel[.panel-name[Good Code]
.small[

```r
rule2_tab2 &lt;- rule2_data %&gt;% 
  add_row(
    rule2_data %&gt;% 
      summarize(
        across(where(is.double), 
               list(Average = mean),
               .names = "{col}")
      ) %&gt;% 
      mutate(Country = "Average")
  ) %&gt;% 
  gt() %&gt;% 
  cols_label(
    avg_07_11 = "Avg.",
    avg_12_16 = "Avg."
  ) %&gt;%
  fmt_number(
    columns = 2:last_col()
  ) %&gt;% 
  tab_style(
    style = cell_fill(
      color = "lightgrey"
    ),
    locations = list(
      cells_body(
        columns = c(avg_07_11, avg_12_16)
        ),
      cells_column_labels(
        columns = c(avg_07_11, avg_12_16)
      )
      )
  ) %&gt;%
  tab_style(
    style = cell_borders(
      sides = "top",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      columns = everything(),
      rows = Country == "Average"
    )
  ) %&gt;% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %&gt;% 
  tab_options(
    column_labels.border.top.color = "black",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black"
  )
```
]

]
]

---

### Rule 3: Right-Align Numbers and Heads

In this case, you want to right align numbers and ideally choose mono-spaced or numerically-aligned fonts, while avoiding "oldstyle" fonts which have numbers with varying vertical placement. Importantly, `gt` already automatically follows best practices for the most part so we have to change some of the defaults to get **bad** examples.


```r
# Prep data
rule3_data &lt;- yield_data %&gt;% 
  filter(Country == "United States", year %in% c(2016)) %&gt;% 
  mutate(crop = str_to_title(crop)) %&gt;% 
  pivot_wider(names_from = year, values_from = "yield") %&gt;% 
  arrange(crop) %&gt;% 
  select(-Country, Crop = crop)
```

---

### 3. Comparison of alignment

Notice that left-alignment or center-alignment of numbers impairs the ability to clearly compare numbers and decimal places. Right-alignment lets you align decimal places and numbers for easy parsing.

.panelset[
.panel[.panel-name[Compare Alignment]
&lt;img src="tables/tab-align.png" width="50%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Code]
.small[

```r
rule3_align &lt;- rule3_data %&gt;% 
  mutate(`Center align` = `2016`,
             `Right align` = `2016`) %&gt;%
  rename(`Left align` = 2) %&gt;% 
  gt() %&gt;% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %&gt;% 
  fmt_number(
    columns = 2:4
  ) %&gt;% 
  cols_align(align = "left",
             columns = 2) %&gt;% 
  cols_align(align = "center",
             columns = 3) %&gt;% 
  cols_align(align = "right",
             columns = 4) %&gt;% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
  )
```

]
]

]

---

### 3. Addendums to Alignment

When aligning text of equal length (long or very short), center alignment of text can be fine or even preferable. For example, very short text with a long header can be better suited to center-align. Equal length text can be centered without negatively affecting the ability to quickly read.

.panelset[
.panel[.panel-name[Bad]
&lt;img src="tables/rule3-add.png" width="30%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Good]
&lt;img src="tables/rule3-mid.png" width="30%" style="display: block; margin: auto;" /&gt;

]


.panel[.panel-name[Bad Code]

```r
rule3_data_addendum &lt;- yield_data %&gt;% 
  filter(
    Country %in% c("Africa"), 
    year &gt;= 2015,
    str_length(crop) == 5
    ) %&gt;%
  group_by(year) %&gt;% 
  mutate(
    crop = str_to_title(crop),
    max_yield = max(yield),
    `Top Crop` = if_else(yield == max_yield, "Y", "N")
    ) %&gt;%
  select(Year = year, Crop = crop, `Top Crop`, Yield = yield) %&gt;% 
  ungroup() %&gt;% 
  head() %&gt;% 
  gt()
```
]

.panel[.panel-name[Good Code]

```r
rule3_data_addendum %&gt;% 
  gt() %&gt;% 
  gt::cols_align(
    align = "center",
    columns = c(`Top Crop`, Crop)
  )
```
]

]


---

### 3. Addendum to Alignment


As an aside, note that `pivot_wider()` can also improve the function of this table, reducing repetition of both the `Crop` and `Top Crop` columns. Again, center alignment helps with the `Top Crop` column regardless.

.pull-left[

```r
rule3_data_addendum %&gt;% 
  pivot_wider(
    names_from = Year, 
    values_from = Yield
    ) %&gt;% 
  gt() %&gt;% 
  gt::cols_align(
    align = "center",
    columns = c(`Top Crop`)
  )
```

]

--

.pull-right[
&lt;img src="tables/rule3-wide.png" width="65%" style="display: block; margin: auto;" /&gt;

]

---

### 3. Choose fonts carefully

For the fonts below, notice that the Default for `gt` along with a monospaced font in `Fira Mono` have nice alignment of decimal places and equally-spaced numbers.

.panelset[

.panel[.panel-name[Table]
&lt;img src="tables/font-tab.png" width="55%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Style Function]

```r
tab_font_fct &lt;- function(data, font, column){
  tab_style(
    data = data,
    style = list(
      cell_text(font = font, decorate = "underline")
    ),
    locations = list(
      cells_column_labels(
        c({{column}})
        ),
      cells_body(
        c({{column}})
      )
  )
  )
}
```

]

.panel[.panel-name[Code]

```r
rule3_text &lt;- rule3_data %&gt;% 
  mutate(Karla = `2016`,
             Cabin = `2016`,
             Georgia = `2016`,
             `Fira Mono` = `2016`) %&gt;%
  rename(Default = 2) %&gt;% 
  gt() %&gt;% 
  tab_font_fct("Default", Default) %&gt;% 
  tab_font_fct("Karla", Karla) %&gt;% 
  tab_font_fct("Cabin", Cabin) %&gt;% 
  tab_font_fct("Georgia", Georgia) %&gt;% 
  tab_font_fct("Fira Mono", `Fira Mono`) %&gt;% 
  fmt_number(columns = 2:6) %&gt;% 
  tab_spanner("Good", c(2,6)) %&gt;% 
  tab_spanner("Bad", 3:5) %&gt;% 
  tab_options(
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3)
  )
```

]

]

---

### Rule 4: Left-align Text and Heads

For labels/strings it is typically more appropriate to left-align. This allows your eye to follow both short and long text vertically to scan a table, along with a clear border.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule4-tab.png" width="75%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Theme]

```r
basic_theme &lt;- function(data) {
  tab_options(
    data,
    column_labels.border.top.color = "white",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.font.weight = "bold",
    table_body.hlines.color = "white",
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    data_row.padding = px(3)
  ) 
}
```

]

.panel[.panel-name[Code]

```r
country_names &lt;- c(
  "British Virgin Islands", "Cayman Islands", 
  "Democratic Republic of Congo", "Luxembourg", 
  "United States","Germany", "New Zealand", "Costa Rica", "Peru"
)
rule4_tab_left &lt;- tibble(
  right = country_names,
  center = country_names,
  left = country_names
) %&gt;% 
  gt()  %&gt;% 
  cols_align(align = "left",
             columns = 3) %&gt;% 
  cols_align(align = "center",
             columns = 2) %&gt;% 
  cols_align(align = "right",
             columns = 1) %&gt;% 
  cols_width(
    everything() ~ px(250)
  ) %&gt;% 
  cols_label(
    right = md("Right aligned and&lt;br&gt;hard to read"),
    center = md("Centered and&lt;br&gt;even harder to read"),
    left = md("Left-aligned and&lt;br&gt;easiest to read")
  ) %&gt;% 
  basic_theme() %&gt;% 
  tab_source_note(md("**Table**: @thomas_mock | **Data**: OurWorldInData.org&lt;br&gt;**Inspiration**: @jschwabish"))
```
]


]

---

### Rule 5: Select the Appropriate Level of Precision

While you can sometimes justify increased decimal places, often 1 or 2 is enough.


.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule5-tab.png" width="40%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Code]

```r
rule5_tab &lt;- yield_data %&gt;% 
  filter(
    Country %in% country_sel, 
    crop == "potatoes", 
    year %in% c(2016)
    ) %&gt;% 
  select(Country, yield) %&gt;% 
  mutate(few = yield, right = yield) %&gt;% 
  gt() %&gt;% 
  fmt_number(
    columns = c(few),
    decimals = 0
  ) %&gt;% 
  fmt_number(
    columns = c(right),
    decimals = 1
  ) %&gt;% 
  cols_label(
    yield = md("Too many&lt;br&gt;decimals"),
    few = md("Too few&lt;br&gt;decimals"),
    right = md("About&lt;br&gt;right")
  ) %&gt;% 
  tab_source_note(md("**Table**: @thomas_mock | **Data**: OurWorldInData.org&lt;br&gt;**Inspiration**: @jschwabish"))
```

]
]

---

### Rule 6: Guide Your Reader with Space

Think of how you want to guide the reader - vertically or horizontally. 

.panelset[
.panel[.panel-name[Vertical]
&lt;img src="tables/rule6-tab.png" width="45%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Horizontal]
&lt;img src="tables/rule6-tab-h.png" width="35%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Data]

```r
rule6_data &lt;- yield_data %&gt;% 
  filter(
    Country %in% country_sel, 
    crop == "potatoes", 
    year %in% c(2014:2016)
    ) %&gt;% 
  filter(crop == "potatoes") %&gt;% 
  pivot_wider(
    names_from = year, 
    values_from = "yield"
    ) %&gt;% 
  select(-crop)
```

]

.panel[.panel-name[Code V]

```r
rule6_tb &lt;- rule6_data %&gt;% 
  arrange(desc(`2014`)) %&gt;% 
  add_row(
    rule6_data %&gt;% 
      summarize(across(where(is.double), list(Average = mean),
                       .names = "{col}")
      ) %&gt;% mutate(Country = "Average")
  ) %&gt;% 
  gt() %&gt;% 
  fmt_number(columns = 2:4,
    decimals = 2) %&gt;% 
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_column_labels(everything())
  ) %&gt;% 
  tab_style(
    style = cell_borders(
      sides = "top",
      color = "black",
      weight = px(2)
    ),
    locations = cells_body(
      columns = everything(),
      rows = Country == "Average"
    )
  ) %&gt;% 
  cols_width(c(Country) ~ px(125),
             2:4 ~ px(75)) %&gt;% 
  basic_theme()
```
]

.panel[.panel-name[Code H]

```r
rule6_tb %&gt;% 
  cols_width(c(Country) ~ px(125),
             2:4 ~ px(55)) %&gt;% 
  tab_options(data_row.padding = px(10),
              table_body.hlines.color = "lightgrey") 
```
]

]

---

### Rule 7: Remove Unit Repetition

.panelset[
.panel[.panel-name[Remove]

```r
rule6_tb %&gt;% 
  fmt_currency(
    columns = 2:4
  )
```

&lt;img src="tables/tab6-dollar.png" width="45%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Left]

```r
rule6_tb %&gt;% 
  fmt_currency(
    columns = 2:4,
    rows = 1
  )
```

&lt;img src="tables/tab6-dollar-1.png" width="45%" style="display: block; margin: auto;" /&gt;


]

.panel[.panel-name[Label]

```r
rule6_tb %&gt;% 
  cols_label(
    `2014` = "2014 ($)",
    `2015` = "2015 ($)",
    `2016` = "2016 ($)"
  ) %&gt;% 
  cols_width(
    2:4 ~ px(100)
  )
```
&lt;img src="tables/tab6-label-dollar.png" width="45%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Spanner]

```r
rule6_tb %&gt;% 
  tab_spanner(
    label = md("**Value of Yield ($)**"),
    columns = 2:4
  ) 
```
&lt;img src="tables/tab6-dollar-yield.png" width="45%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Footnote]

```r
rule6_tb %&gt;% 
  tab_footnote(
    footnote = md("**Value of Yield ($)**"),
    locations = cells_column_labels(2:4)
  )
```
&lt;img src="tables/tab6-dollar-yield-ft.png" width="45%" style="display: block; margin: auto;" /&gt;

]

]

---


### Rule 8: Highlight Outliers  

With large data tables, it can be useful to take a page from our Data Viz and highlight outliers with color or shape.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/tab8-plain.png" width="75%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Data]

```r
rule8_data &lt;- yield_data %&gt;% 
  filter(
    Country %in% country_sel, 
    crop == "potatoes", 
    year %in% 2009:2017
    ) %&gt;% 
  group_by(Country) %&gt;% 
  mutate(pct_change = (yield/lag(yield)-1)*100) %&gt;% 
  ungroup() %&gt;% 
  filter(between(year, 2010, 2016)) %&gt;% 
  select(Country, year, pct_change) %&gt;% 
  pivot_wider(names_from = year, values_from = pct_change)
```
]

.panel[.panel-name[Code]

```r
rule8_tb &lt;- rule8_data %&gt;% 
  gt() %&gt;% 
  fmt_number(2:last_col()) %&gt;% 
  cols_label(
    Country = ""
  ) %&gt;% 
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(everything())
  ) %&gt;% 
  basic_theme() %&gt;% 
  cols_width(c(Country) ~ px(125),
             2:last_col() ~ px(75))
```
]

]

---

### Rule 8: Highlight Outliers

With a bit of color added we can clearly focus on the outliers.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule8-red.png" width="75%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Data]

```r
rule8_data &lt;- yield_data %&gt;% 
  filter(
    Country %in% country_sel, 
    crop == "potatoes", 
    year %in% 2009:2017
    ) %&gt;% 
  group_by(Country) %&gt;% 
  mutate(pct_change = (yield/lag(yield)-1)*100) %&gt;% 
  ungroup() %&gt;% 
  filter(between(year, 2010, 2016)) %&gt;% 
  select(Country, year, pct_change) %&gt;% 
  pivot_wider(names_from = year, values_from = pct_change)
```
]

.panel[.panel-name[Code]

```r
rule8_color &lt;- rule8_tb %&gt;% 
  tab_style(
    style = cell_text(color = "red"),
    locations = list(
      body_fct(2, `2010`),
      body_fct(3, `2011`),
      body_fct(4, `2012`),
      body_fct(5, `2013`),
      body_fct(6, `2014`),
      body_fct(7, `2015`),
      body_fct(8, `2016`)
    )
  ) 
```
]

.panel[.panel-name[Function]

```r
body_fct &lt;- function(col, row){
  cells_body(
        columns = col,
        rows = {{row}} &lt; 0
    )
}
```

]

]

---

### Rule 8: Highlight Outliers

We can *really* pull the focus with background **fill** of each cell *outlier*.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule8-fill.png" width="75%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Code]

```r
rule8_fill &lt;- rule8_tb %&gt;% 
  tab_style(
    style = list(
      cell_fill(color = scales::alpha("red", 0.7)),
      cell_text(color = "white", weight = "bold")
      ),
    locations = list(
      body_fct(2, `2010`),
      body_fct(3, `2011`),
      body_fct(4, `2012`),
      body_fct(5, `2013`),
      body_fct(6, `2014`),
      body_fct(7, `2015`),
      body_fct(8, `2016`)
    )
  ) %&gt;% 
  tab_source_note(md("**Table**: @thomas_mock | **Data**: OurWorldInData.org&lt;br&gt;**Inspiration**: @jschwabish"))
```
]

]

---

### Rule 9: Group Similar Data and Increase White Space

In this rule, you want to make sure to group similar categories to make parsing the table easier. We can also increase white space, or even remove repeats to increase the data-to-ink ratio.


```r
rule9_data &lt;- yield_data %&gt;% 
  filter(Country %in% country_sel[-5], year %in% c(2015, 2016),
         crop %in% c("wheat", "potatoes", "rice", "soybeans"),
         !is.na(yield)) %&gt;% 
  pivot_wider(names_from = year, values_from = yield) %&gt;% 
  rowwise() %&gt;% 
  mutate(crop = str_to_title(crop),
         pct_change = (`2016`/`2015`-1)*100) %&gt;%
  group_by(Country) %&gt;% 
  arrange(desc(`2015`)) %&gt;% 
  ungroup() 
```

---

### 9. Bad Example

.pull-left[

```r
rule9_bad &lt;- rule9_data %&gt;% 
  gt() %&gt;% 
  fmt_number(
    columns = c(`2015`, `2016`, pct_change)
  ) %&gt;% 
  tab_spanner(
    columns = c(`2015`, `2016`),
    label = md("**Yield in&lt;br&gt;Tonnes/Hectare**")
    ) %&gt;%  
  cols_width(
    c(crop) ~ px(125),
    c(`2015`, `2016`, pct_change) ~ 100
  ) 
```

]

--
  
.pull-right[
&lt;img src="tables/rule9-bad.png" width="65%" style="display: block; margin: auto;" /&gt;

]

---

### 9. `gt` native grouping

`gt` provides row group levels that we can use to separate by Country.

.pull-left[
.small[

```r
rule9_grp &lt;- rule9_data %&gt;% 
  gt(groupname_col = "Country") %&gt;% 
  tab_stubhead("label") %&gt;% 
  tab_options(
    table.width = px(300)
  ) %&gt;% 
  cols_label(
    crop = "",
    pct_change = md("Percent&lt;br&gt;Change")
  ) %&gt;% 
  fmt_number(
    columns = c(`2015`, `2016`, pct_change)
  ) %&gt;% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_row_groups(),
      cells_column_labels(everything())
    )
  ) %&gt;% 
  tab_spanner(
    columns = c(`2015`, `2016`),
    label = md("**Yield in Tonnes/Hectare**")
    ) %&gt;%  
  cols_width(
    c(crop) ~ px(125),
    c(`2015`, `2016`, pct_change) ~ 100
  ) %&gt;% 
  basic_theme()
```

]
]

--

.pull-right[
&lt;img src="tables/rule9-group.png" width="50%" style="display: block; margin: auto;" /&gt;

]

---

### 9. Remove duplicate data

Alternatively, we can remove some observations to create more white space.

.pull-left[
.small[

```r
rule9_dup &lt;- rule9_data %&gt;% 
  arrange(Country) %&gt;% 
  gt() %&gt;% 
  cols_label(
    Country = "",
    crop = "Crop",
    pct_change = md("Percent&lt;br&gt;Change")
  ) %&gt;% 
  tab_spanner(columns = c(`2015`, `2016`),
              label = md("**Yield in Tonnes/Hectare**")) %&gt;% 
  fmt_number(
    columns = c(`2015`, `2016`, pct_change)
  ) %&gt;% 
  text_transform(
    locations = cells_body(
      columns = c(Country),
      rows = crop != "Potatoes"
    ),
    fn = function(x){
      paste0("")
    }
  ) %&gt;% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_row_groups(),
      cells_column_labels(everything())
    )
  ) %&gt;% 
  cols_width(
    c(Country, crop) ~ px(125),
    c(`2015`, `2016`, pct_change) ~ 100
  ) %&gt;% 
  basic_theme()
```

]
]

--

.pull-right[
&lt;img src="tables/rule9-white.png" width="70%" style="display: block; margin: auto;" /&gt;

]

---

### Rule 10: Add visualizations When Appropriate

While data viz and tables are different tools, you can combine them in clever ways to further engage the reader. Embedded data viz can reveal trends, while the table itself shows the raw data for lookup.

.small[


```r
country_sel &lt;- c(
  "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
  "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )

rule10_data &lt;- yield_data %&gt;% 
  filter(
    year %in% c(2013,2017), 
    crop == "potatoes", 
    Country %in% country_sel
    ) %&gt;% 
  pivot_wider(names_from = year, values_from = yield)

rule10_data
```

```
## # A tibble: 9 × 4
##   Country     crop     `2013` `2017`
##   &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1 Brazil      potatoes   27.8   30.9
## 2 Denmark     potatoes   41.6   43.7
## 3 El Salvador potatoes   42.6   29.2
## 4 France      potatoes   43.2   44.0
## 5 Germany     potatoes   39.8   46.8
## 6 Ireland     potatoes   38.3   44.8
## 7 Italy       potatoes   25.2   27.7
## 8 Lebanon     potatoes   26.1   25.1
## 9 Netherlands potatoes   42.2   46.0
```

]

---

### 10. Sparklines - Trends across Time

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule10-spark.png" width="25%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Data]

```r
small_yield &lt;- yield_data %&gt;% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% country_sel
  ) 

split_yield &lt;- split(small_yield$yield, small_yield$Country)
```

]

.panel[.panel-name[Code]
.small[

```r
rule10_spark &lt;- rule10_data %&gt;% 
  mutate(spark = map(split_yield, kableExtra::spec_plot),
         spark = map(spark, "svg_text"),
         spark = map(spark, ~html(as.character(.x)))) %&gt;% 
  select(-crop) %&gt;% 
  gt() %&gt;% 
  cols_label(
    spark = "2013-2017"
  ) %&gt;% 
  fmt_number(2:3) %&gt;% 
  tab_spanner(
    label = md("Potato Yield in&lt;br&gt;Tonnes/Hectare"),
    columns = c(2,3)
  ) %&gt;% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_spanners(everything()),
      cells_column_labels(everything())
    )
  ) %&gt;%  
  tab_options(
    row_group.border.top.width = px(3),
    row_group.border.top.color = "black",
    row_group.border.bottom.color = "black",
    table.border.top.color = "white",
    table.border.top.width = px(3),
    table.border.bottom.color = "white",
    table.border.bottom.width = px(3),
    column_labels.border.bottom.color = "black",
    column_labels.border.bottom.width = px(2),
  )
```

]
]

]

---

### 10. Barplot

For this example we can use barplots to indicate the average across the 5 years. Many thanks to the `formattable` author Renkun Kun and others like `rtjohnson12` who have shown examples about how to build up a bar chart with HTML! Thanks also to [Christophe Dervieux](https://community.rstudio.com/t/create-interactive-links-in-gt-table-in-rmarkdown/70266/2) for a great example of `gt` + custom HTML on RStudio Community.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule10-bar.png" width="45%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Functions]
.small[

```r
# Example of using glue to just paste the value into pre-created HTML block
# Example adapted from rtjohnson12 at: 
# https://github.com/renkun-ken/formattable/issues/79#issuecomment-573165954
bar_chart &lt;- function(value, color = "red", display_value = NULL){
  # Choose to display percent of total
  if (is.null(display_value)) {
    display_value &lt;- "&amp;nbsp;"
  } else {
    display_value &lt;- display_value
  }
  # paste color and value into the html string
  glue::glue("&lt;span style=\"display: inline-block; direction: ltr; border-radius: 4px; padding-right: 2px; background-color: {color}; color: {color}; width: {value}%\"&gt; {display_value} &lt;/span&gt;")
}
# create a color palette w/ paletteer
col_pal &lt;- function(value){
  # set high and low
  domain_range &lt;- range(c(rule10_data$`2013`, rule10_data$`2017`))
  # create the color based of domain
  scales::col_numeric(
    paletteer::paletteer_d("ggsci::blue_material") %&gt;% as.character(), 
    domain = c(min(value), max(value))
      )(value)
}
```

]
]

.panel[.panel-name[Data]
.small[

```r
bar_yields &lt;- yield_data %&gt;% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
      )
    ) %&gt;% 
  pivot_wider(names_from = year, values_from = yield) %&gt;%  
  select(-crop) %&gt;% 
  rowwise() %&gt;% 
  mutate(
    mean = mean(c(`2013`, `2014`, `2015`, `2016`, `2017`))
    ) %&gt;% 
  ungroup() %&gt;% 
  select(Country, `2013`, `2017`, `mean`) %&gt;% 
  mutate(
    bar = round(mean/max(mean)*100, digits = 2),
    color = col_pal(bar),
    bar_chart = bar_chart(bar, color = color),
    bar_chart = map(bar_chart, ~gt::html(as.character(.x)))) %&gt;% 
  select(-bar, -color)
```

]
]



.panel[.panel-name[Code]
.small[

```r
rule10_bar &lt;- bar_yields %&gt;% 
  gt() %&gt;% 
  cols_width(
    c(bar_chart) ~ px(110),
    c(mean, `2013`, `2017`) ~ px(90)
    ) %&gt;% 
  cols_label(
    mean = md("Average&lt;br&gt;2013-17"),
    bar_chart = ""
  ) %&gt;% 
  cols_align(
    align = "right",
    columns = 2:4
  ) %&gt;% 
  cols_align(
    align = "left",
    columns = c(bar_chart)
  ) %&gt;% 
  fmt_number(2:4) %&gt;% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_labels(everything())
    )
  ) %&gt;%  
  basic_theme() %&gt;% 
  tab_options(data_row.padding = px(8)) %&gt;%
  tab_footnote(footnote = "Potato Yield in Tonnes per Hectare",
               locations = cells_column_labels(
                 columns =2:4
               ))
```

]
]

]

---

### 10. Heatmap

Lastly, you can add colors across the entire plot itself to show trends across the data over time and across country.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule10-heat.png" width="45%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Data]

```r
rule10_wide &lt;- yield_data %&gt;% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %&gt;% 
  pivot_wider(names_from = year, values_from = yield) %&gt;% 
  arrange(desc(`2013`)) %&gt;% 
  select(-crop)
```

]

.panel[.panel-name[Code]
.small[

```r
rule10_heat &lt;- rule10_wide %&gt;% 
  gt() %&gt;% 
  data_color(
    columns = 2:6, 
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(
        palette = "ggsci::blue_material"
      ) %&gt;% as.character(),
      domain = NULL
    )
  ) %&gt;% 
  fmt_number(2:6) %&gt;% 
  tab_spanner(
    label = "Potato Yield in Tonnes/Hectare",
    columns = c(2:6)
  ) %&gt;% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_spanners(everything()),
      cells_column_labels(everything())
    )
  ) %&gt;%  
  cols_width(
    1 ~ px(125),
    2:6 ~ px(65)
  ) %&gt;% 
  basic_theme() 
```
]
]

]

---

### 10. Percent Change

Ok I lied! One more example, with color for a numeric column.

.panelset[
.panel[.panel-name[Table]
&lt;img src="tables/rule10-pct.png" width="45%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Data]

```r
rule10_wide &lt;- yield_data %&gt;% 
  filter(
    year %in% c(2013:2017), 
    crop == "potatoes", 
    Country %in% c(
      country_sel, "Germany", "Brazil", "Ireland", "Lebanon", "Italy", 
      "Netherlands", "France", "Denmark", "El Salvador", "Denmark"
    )
  ) %&gt;% 
  pivot_wider(names_from = year, values_from = yield) %&gt;% 
  arrange(Country) %&gt;% 
  select(-crop) %&gt;% 
  mutate(pct_change = (`2017`/`2013`-1)*100)
```


]

.panel[.panel-name[Code]
.small[

```r
rule10_pct &lt;- rule10_wide %&gt;% 
  gt()%&gt;% 
  fmt_number(2:7) %&gt;% 
  cols_label(
    pct_change = md("% Change&lt;br&gt;2013-17")
  ) %&gt;% 
  tab_style(
    style = list(
      cell_text(color = "red")
    ),
    locations = cells_body(
      columns = c(pct_change),
      rows = pct_change &lt;= 0
    )
  ) %&gt;% 
  tab_style(
    style = list(
      cell_text(color = "blue")
    ),
    locations = cells_body(
      columns = c(pct_change),
      rows = pct_change &gt; 0
    )
  ) %&gt;% 
  tab_spanner(
    label = "Potato Yield in Tonnes/Hectare",
    columns = c(2:6)
  ) %&gt;% 
  tab_style(
    style = cell_text(color = "black", weight = "bold"),
    locations = list(
      cells_column_spanners(everything()),
      cells_column_labels(everything())
    )
  ) %&gt;%  
  basic_theme() %&gt;% 
  tab_options(data_row.padding = px(8)) 
```
]
]


]


---

### 10 Guidelines for Better Tables

.pull-left[
#### 1. Offset the Heads from the Body  
#### 2. Use Subtle Dividers over Heavy Grids  
#### 3. Right-Align Numbers  
#### 4. Left-Align Text  
#### 5. Select Appropriate Precision  
]

.pull-right[
#### 6. Guide your Reader with Space between Rows and Columns  
#### 7. Remove Unit Repetition  
#### 8. Highlight Outliers  
#### 9. Group Similar Data and Increase White Space  
#### 10. Add Visualizations when Appropriate  
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"selfContained": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
