<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.294">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Thomas Mock">
<meta name="description" content="Doing more with dplyr and SQL">
<title>The MockUp - Bigger, nflfastR, dbplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><script src="../../site_libs/clipboard/clipboard.min.js"></script><meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script><script src="../../site_libs/quarto-search/fuse.min.js"></script><script src="../../site_libs/quarto-search/quarto-search.js"></script><link href="../../themockup.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><script src="../../site_libs/quarto-html/anchor.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="The MockUp - Bigger, nflfastR, dbplyr">
<meta property="og:description" content="Doing more with dplyr and SQL
">
<meta property="og:image" content="https://images.unsplash.com/photo-1566577739112-5180d4bf9390?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1526&amp;q=80">
<meta property="og:site-name" content="The MockUp">
<meta name="twitter:title" content="The MockUp - Bigger, nflfastR, dbplyr">
<meta name="twitter:description" content="Doing more with dplyr and SQL
">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1566577739112-5180d4bf9390?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1526&amp;q=80">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The MockUp</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../static/resources/resources.html">Resources</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jthomasmock"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/thomas_mock"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://jthomasmock.github.io/gtExtras/"><i class="bi bi-table" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://drinksbytom.com"><i class="bi bi-cup-straw" role="img">
</i> 
 </a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Bigger, nflfastR, dbplyr</h1>
                          <div class="quarto-categories">
                <div class="quarto-category">NFL</div>
                <div class="quarto-category">nflscrapR</div>
                <div class="quarto-category">nflfastR</div>
                <div class="quarto-category">SQL</div>
                <div class="quarto-category">tidyverse</div>
              </div>
                  </div>
  </div>
    
  <div>
    <div class="description">
      <p>Doing more with dplyr and SQL</p>
    </div>
  </div>




  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Thomas Mock </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">04-28-2020</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#nflfastr" id="toc-nflfastr" class="nav-link active" data-scroll-target="#nflfastr"><code>nflfastR</code></a>
  <ul class="collapse">
<li><a href="#more-data" id="toc-more-data" class="nav-link" data-scroll-target="#more-data">More data</a></li>
  </ul>
</li>
  <li><a href="#read-in-the-data" id="toc-read-in-the-data" class="nav-link" data-scroll-target="#read-in-the-data">Read in the data</a></li>
  <li>
<a href="#enter-sql" id="toc-enter-sql" class="nav-link" data-scroll-target="#enter-sql">Enter SQL</a>
  <ul class="collapse">
<li><a href="#create-the-sqlite-database" id="toc-create-the-sqlite-database" class="nav-link" data-scroll-target="#create-the-sqlite-database">Create the <code>SQLite</code> database</a></li>
  </ul>
</li>
  <li>
<a href="#dbplyr" id="toc-dbplyr" class="nav-link" data-scroll-target="#dbplyr"><code>dbplyr</code></a>
  <ul class="collapse">
<li><a href="#open-a-connection" id="toc-open-a-connection" class="nav-link" data-scroll-target="#open-a-connection">Open a connection</a></li>
  <li><a href="#query-the-database" id="toc-query-the-database" class="nav-link" data-scroll-target="#query-the-database">Query the database</a></li>
  <li><a href="#collect-the-data" id="toc-collect-the-data" class="nav-link" data-scroll-target="#collect-the-data">Collect the data</a></li>
  </ul>
</li>
  <li><a href="#tldr" id="toc-tldr" class="nav-link" data-scroll-target="#tldr">TLDR</a></li>
  <li><a href="#additional-notes" id="toc-additional-notes" class="nav-link" data-scroll-target="#additional-notes">Additional Notes</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p><img src="https://images.unsplash.com/photo-1566577739112-5180d4bf9390?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1526&amp;q=80" class="img-fluid"></p>
<section id="nflfastr" class="level1"><h1><code>nflfastR</code></h1>
<p>Ben Baldwin and Sebastian Carl released <a href="https://mrcaseb.github.io/nflfastR/"><code>nflfastR</code></a> yesterday to provide faster scraping of NFL play-by-play data as well as data all the way back to 2000! This builds upon the work of the <code>nflscrapR</code> team who paved the way for this data for NFL games between 2009 and 2019.</p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
INTRODUCING: <a href="https://twitter.com/nflfastR?ref_src=twsrc%5Etfw"><span class="citation" data-cites="nflfastR">@nflfastR</span></a>, an R package for scraping NFL data faster ⚡<br><br>🏈 Play-by-play of all NFL games going back to 2000<br>🏈 Includes Completion Probability and CPOE going back to 2006<br>🏈 Fast functions for scraping team rosters and highlight videos<a href="https://t.co/sgrq8GdoWJ">https://t.co/sgrq8GdoWJ</a> <a href="https://t.co/fqbyE1pPHE">pic.twitter.com/fqbyE1pPHE</a>
</p>
— Ben Baldwin (<span class="citation" data-cites="benbbaldwin">@benbbaldwin</span>) <a href="https://twitter.com/benbbaldwin/status/1254846456390975494?ref_src=twsrc%5Etfw">April 27, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><section id="more-data" class="level2"><h2 class="anchored" data-anchor-id="more-data">More data</h2>
<p>With more data comes excitement - we can do new analysis with very similar code!</p>
<p>However, the 2000-2019 data consists of ~2.25 GB of data, 291 variables and 903,998 rows… this is 263,063,418 observations! While this is not anywhere close to too much for R to handle, it can start to feel a little intimidating to read it all into memory. I’ll be covering some tooling to work with relatively larger datasets using the same <code>dplyr</code> tools you know and love!</p>
</section></section><section id="read-in-the-data" class="level1"><h1>Read in the data</h1>
<p>Ben and Sebastian were kind enough to provide all of the .RDS files for every year between 2000-2019 on GitHub for ease of download. With a quick <code>purrr</code> call we can download all 20 years of data and pull them into memory. We can also save them to local storage for offline access or to at least not need to re-download them down the line.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">read_pbp_rds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_{year}.rds'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">all_pbp</span> <span class="op">&lt;-</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2019</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">read_pbp_rds</span><span class="op">)</span>
  
<span class="va">all_pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">write_rds</span><span class="op">(</span><span class="st">"data/2000-2019_pbp_raw.rds"</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, as mentioned before this is ~ 2 GB of data in memory, which can take a while to download and/or read in especially if you do this multiple times as opposed to in just one session. Also - there are VERY few times where you actually need to pull in all of the specific columns and/or rows for your analysis, why waste time reading in data that you don’t need?</p>
</section><section id="enter-sql" class="level1"><h1>Enter SQL</h1>
<p>No no, I’m not going to make you learn SQL to work with this dataset, but we are going to use SQL inside R. Specifically, we’re going to play around with <code>SQLite</code> - in their own words:</p>
<blockquote class="blockquote">
<p>SQLite is a C-language library that implements a small, fast, self-contained, high-reliability, full-featured, SQL database engine. SQLite is the most used database engine in the world.</p>
</blockquote>
<p>What this provides for us is a super lightweight storage and query format that works nicely with R and <code>dplyr</code>. We don’t have to mess around with creating an entire database but rather have a small self-contained file that allows for many of the same SQL-features.</p>
<p>For a deeper dive on the <code>RSQLite</code> package, with basic and advanced usage check out the <a href="https://rsqlite.r-dbi.org/">packagedown site</a>. Additionally, the <a href="https://datacarpentry.org/R-ecology-lesson/05-r-and-databases.html">Data Carpentry guide</a> is pretty similar to this guide but aimed at scientists.</p>
<section id="create-the-sqlite-database" class="level2"><h2 class="anchored" data-anchor-id="create-the-sqlite-database">Create the <code>SQLite</code> database</h2>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsqlite.r-dbi.org">RSQLite</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org">DBI</a></span><span class="op">)</span>

<span class="co"># create the "empty" database</span>
<span class="va">mydb</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data/pbp_db.sqlite"</span><span class="op">)</span>
<span class="va">mydb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># &lt;SQLiteConnection&gt;</span>
<span class="co">#   Path: /Users/thomasmock/nflscrapR/data/pbp_db.sqlite</span>
<span class="co">#   Extensions: TRUE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># Write the in-memory data into the database as a table</span>
<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html">dbWriteTable</a></span><span class="op">(</span><span class="va">mydb</span>, <span class="st">"pbp_raw_2000-2019"</span>, <span class="va">raw_pbp</span><span class="op">)</span>

<span class="co"># list the table</span>
<span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html">dbListTables</a></span><span class="op">(</span><span class="va">mydb</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># [1] "pbp_raw_2000-2019"</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok - so to recap in about 2 lines of code we have created and populated a <code>SQLite</code> database solely through R. Now, the <code>SQLite</code> file is only around 1 GB compared to our 2 GB .RDS - so it’s more efficiently stored and allows us to do some other cool things as seen below.</p>
</section></section><section id="dbplyr" class="level1"><h1><code>dbplyr</code></h1>
<p>Now the magic really happens: <code>dplyr</code> has a built-in package called <code>dbplyr</code>, this is a translation engine that lets you write <code>dplyr</code> code that is evaluated as SQL.</p>
<p>Full details at the <a href="https://dbplyr.tidyverse.org/articles/dbplyr.html"><code>dbplyr</code> site</a>.</p>
<p>The basic concept is:</p>
<ul>
<li><p>Connect to a datasource/database</p></li>
<li><p>Query the database INSIDE the database or on disk</p></li>
<li><p>Pull the data into memory only when you’re ready</p></li>
</ul>
<section id="open-a-connection" class="level2"><h2 class="anchored" data-anchor-id="open-a-connection">Open a connection</h2>
<p>We can open the connection by calling <code><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl()</a></code> on the database we have open (<code>mydb</code>) and indicating which table we want to query.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dbplyr.tidyverse.org/">dbplyr</a></span><span class="op">)</span>
<span class="co"># Open a queryable connection with the database</span>
<span class="va">pbp_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">mydb</span>, <span class="st">"pbp_raw_2000-2019"</span><span class="op">)</span>

<span class="va">pbp_db</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># Source:   table&lt;pbp_raw_2000-2019&gt; [?? x 291]</span>
<span class="co"># Database: sqlite 3.30.1 </span>
<span class="co"># [/Users/thomasmock/nflscrapR/data/pbp_db.sqlite]</span>

<span class="co">#   play_id game_id home_team away_team posteam posteam_type defteam side_of_field yardline_100</span>
<span class="co">#      &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;</span>
<span class="co">#  1      34  2.00e9 NYG       ARI       NYG     home         ARI     NYG                     70</span>
<span class="co">#  2      70  2.00e9 NYG       ARI       ARI     away         NYG     NYG                     25</span>
<span class="co">#  3     106  2.00e9 NYG       ARI       ARI     away         NYG     ARI                     65</span>
<span class="co">#  4     131  2.00e9 NYG       ARI       ARI     away         NYG     ARI                     63</span>
<span class="co">#  5     148  2.00e9 NYG       ARI       ARI     away         NYG     ARI                     63</span>
<span class="co">#  6     165  2.00e9 NYG       ARI       ARI     away         NYG     ARI                     63</span>
<span class="co">#  7     190  2.00e9 NYG       ARI       NYG     home         ARI     NYG                     78</span>
<span class="co">#  8     211  2.00e9 NYG       ARI       NYG     home         ARI     NYG                     70</span>
<span class="co">#  9     232  2.00e9 NYG       ARI       NYG     home         ARI     NYG                     67</span>
<span class="co"># 10     253  2.00e9 NYG       ARI       NYG     home         ARI     NYG                     68</span>
<span class="co"># # … with more rows, and 282 more variables: game_date &lt;dbl&gt;, quarter_seconds_remaining &lt;dbl&gt;,</span>
<span class="co"># #   half_seconds_remaining &lt;dbl&gt;, game_seconds_remaining &lt;dbl&gt;, game_half &lt;chr&gt;,</span>
<span class="co"># #   quarter_end &lt;dbl&gt;, drive &lt;dbl&gt;, sp &lt;dbl&gt;, qtr &lt;dbl&gt;, down &lt;chr&gt;, goal_to_go &lt;dbl&gt;,</span>
<span class="co"># #   time &lt;chr&gt;, yrdln &lt;chr&gt;, ydstogo &lt;dbl&gt;, ydsnet &lt;dbl&gt;, desc &lt;chr&gt;, play_type &lt;chr&gt;,</span>
<span class="co"># #   yards_gained &lt;dbl&gt;, shotgun &lt;dbl&gt;, no_huddle &lt;dbl&gt;, qb_dropback &lt;dbl&gt;, qb_kneel &lt;dbl&gt;,</span>
<span class="co"># #   qb_spike &lt;dbl&gt;, qb_scramble &lt;dbl&gt;, pass_length &lt;chr&gt;, pass_location &lt;chr&gt;,</span>
<span class="co"># #   air_yards &lt;dbl&gt;, yards_after_catch &lt;dbl&gt;, run_location &lt;chr&gt;, run_gap &lt;chr&gt;,</span>
<span class="co"># #   field_goal_result &lt;chr&gt;, kick_distance &lt;dbl&gt;, extra_point_result &lt;chr&gt;,</span>
<span class="co"># #   two_point_conv_result &lt;chr&gt;, home_timeouts_remaining &lt;dbl&gt;,</span>
<span class="co"># #   away_timeouts_remaining &lt;dbl&gt;, timeout &lt;dbl&gt;, timeout_team &lt;chr&gt;, td_team &lt;chr&gt;,</span>
<span class="co"># #   posteam_timeouts_remaining &lt;dbl&gt;, defteam_timeouts_remaining &lt;dbl&gt;,</span>
<span class="co"># #   total_home_score &lt;dbl&gt;, total_away_score &lt;dbl&gt;, posteam_score &lt;dbl&gt;, defteam_score &lt;dbl&gt;,</span>
<span class="co"># #   score_differential &lt;dbl&gt;, posteam_score_post &lt;dbl&gt;, defteam_score_post &lt;dbl&gt;,</span>
<span class="co"># #   score_differential_post &lt;dbl&gt;, no_score_prob &lt;dbl&gt;, opp_fg_prob &lt;dbl&gt;,</span>
<span class="co"># #   opp_safety_prob &lt;dbl&gt;, opp_td_prob &lt;dbl&gt;, fg_prob &lt;dbl&gt;, safety_prob &lt;dbl&gt;,</span>
<span class="co"># #   td_prob &lt;dbl&gt;, extra_point_prob &lt;dbl&gt;, two_point_conversion_prob &lt;dbl&gt;, ep &lt;dbl&gt;,</span>
<span class="co"># #   epa &lt;dbl&gt;, total_home_epa &lt;dbl&gt;, total_away_epa &lt;dbl&gt;, total_home_rush_epa &lt;dbl&gt;,</span>
<span class="co"># #   total_away_rush_epa &lt;dbl&gt;, total_home_pass_epa &lt;dbl&gt;, total_away_pass_epa &lt;dbl&gt;,</span>
<span class="co"># #   air_epa &lt;dbl&gt;, yac_epa &lt;dbl&gt;, comp_air_epa &lt;dbl&gt;, comp_yac_epa &lt;dbl&gt;,</span>
<span class="co"># #   total_home_comp_air_epa &lt;dbl&gt;, total_away_comp_air_epa &lt;dbl&gt;,</span>
<span class="co"># #   total_home_comp_yac_epa &lt;dbl&gt;, total_away_comp_yac_epa &lt;dbl&gt;,</span>
<span class="co"># #   total_home_raw_air_epa &lt;dbl&gt;, total_away_raw_air_epa &lt;dbl&gt;, total_home_raw_yac_epa &lt;dbl&gt;,</span>
<span class="co"># #   total_away_raw_yac_epa &lt;dbl&gt;, wp &lt;dbl&gt;, def_wp &lt;dbl&gt;, home_wp &lt;dbl&gt;, away_wp &lt;dbl&gt;,</span>
<span class="co"># #   wpa &lt;dbl&gt;, home_wp_post &lt;dbl&gt;, away_wp_post &lt;dbl&gt;, total_home_rush_wpa &lt;dbl&gt;,</span>
<span class="co"># #   total_away_rush_wpa &lt;dbl&gt;, total_home_pass_wpa &lt;dbl&gt;, total_away_pass_wpa &lt;dbl&gt;,</span>
<span class="co"># #   air_wpa &lt;dbl&gt;, yac_wpa &lt;dbl&gt;, comp_air_wpa &lt;dbl&gt;, comp_yac_wpa &lt;dbl&gt;,</span>
<span class="co"># #   total_home_comp_air_wpa &lt;dbl&gt;, total_away_comp_air_wpa &lt;dbl&gt;,</span>
<span class="co"># #   total_home_comp_yac_wpa &lt;dbl&gt;, total_away_comp_yac_wpa &lt;dbl&gt;,</span>
<span class="co"># #   total_home_raw_air_wpa &lt;dbl&gt;, total_away_raw_air_wpa &lt;dbl&gt;, total_home_raw_yac_wpa &lt;dbl&gt;,</span>
<span class="co"># #   …</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Boom - 1 line of code and we now have a connection - also notice that the output has the following info at the top: &gt; <code>table&lt;pbp_raw_2000-2019&gt; [?? x 291]</code></p>
<p>Notice that it has the right number of columns (291) but an unknown number of rows. This is because the data hasn’t been read into memory yet, and it has only returned the essentially the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> of the data. We don’t pull the data into memory until we call a new function - <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code> this then pulls the data as it is at that point in the pipe into memory.</p>
</section><section id="query-the-database" class="level2"><h2 class="anchored" data-anchor-id="query-the-database">Query the database</h2>
<p>Now let’s do a basic query - we’ll time it to see how long this takes on all 263 million observations.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">tic</span><span class="op">(</span><span class="op">)</span>
<span class="va">pbp_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">play_type</span>, <span class="va">yards_gained</span>, <span class="va">penalty</span>, <span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"run"</span>, <span class="st">"pass"</span><span class="op">)</span>, <span class="va">penalty</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">play_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_yds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu">toc</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># Source:   lazy query [?? x 4]</span>
<span class="co"># Database: sqlite 3.30.1 [/Users/thomasmock/nflscrapR/data/pbp_db.sqlite]</span>
<span class="co"># Groups:   season</span>
<span class="co">#    season play_type avg_yds     n</span>
<span class="co">#     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#  1   2000 pass         5.84 17567</span>
<span class="co">#  2   2000 run          4.08 13682</span>
<span class="co">#  3   2001 pass         5.85 17264</span>
<span class="co">#  4   2001 run          4.04 13500</span>
<span class="co">#  5   2002 pass         5.85 18313</span>
<span class="co">#  6   2002 run          4.27 13746</span>
<span class="co">#  7   2003 pass         5.79 17322</span>
<span class="co">#  8   2003 run          4.24 14033</span>
<span class="co">#  9   2004 pass         6.12 17238</span>
<span class="co"># 10   2004 run          4.24 13828</span>

<span class="co"># 1.048 sec elapsed  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So we used our traditional <code>dplyr</code> code, it ran as SQL on the backend and took about 1 sec.&nbsp;Now, 1 sec is not THAT fast - and the same operation IN memory would be about 0.2 sec, but we save a lot of time on the read and can do lots of ad-hoc queries without pulling the data in. Also imagine a world where the data is much larger than memory, this same workflow would work on 100 GB of data or even petabytes of data with translation to <code>spark</code> via <code>sparklyr</code> for example.</p>
</section><section id="collect-the-data" class="level2"><h2 class="anchored" data-anchor-id="collect-the-data">Collect the data</h2>
<p>Lastly - we can also pull the data into memory, via <code><a href="https://dplyr.tidyverse.org/reference/compute.html">collect()</a></code>. This allows us to take the data and either continue to work with the summary or pass it to something like <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">tic</span><span class="op">(</span><span class="op">)</span>
<span class="va">pbp_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">play_type</span>, <span class="va">yards_gained</span>, <span class="va">penalty</span>, <span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"run"</span>, <span class="st">"pass"</span><span class="op">)</span>, <span class="va">penalty</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">play_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_yds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">season</span>, y <span class="op">=</span> <span class="va">avg_yds</span>, color <span class="op">=</span> <span class="va">play_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span>
<span class="fu">toc</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># 1.451 sec elapsed  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="temp_plot.png" class="img-fluid"></p>
<p>So, in about 1.5 seconds we we’re able to query all of 2000-2019 and get a very basic <code>ggplot</code>. Cool!</p>
</section></section><section id="tldr" class="level1"><h1>TLDR</h1>
<p>Altogether now skipping the additional info. You can see just how succintly you can use this method. It’s just like reading in other data formats!</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">pbp_db</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data/pbp_db.sqlite"</span><span class="op">)</span>, <span class="st">"pbp_raw_2000-2019"</span><span class="op">)</span>

<span class="va">pbp_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">play_type</span>, <span class="va">yards_gained</span>, <span class="va">penalty</span>, <span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"run"</span>, <span class="st">"pass"</span><span class="op">)</span>, <span class="va">penalty</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">play_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_yds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># A tibble: 40 x 4</span>
<span class="co"># Groups:   season [20]</span>
<span class="co">#    season play_type avg_yds     n</span>
<span class="co">#     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#  1   2000 pass         5.84 17567</span>
<span class="co">#  2   2000 run          4.08 13682</span>
<span class="co">#  3   2001 pass         5.85 17264</span>
<span class="co">#  4   2001 run          4.04 13500</span>
<span class="co">#  5   2002 pass         5.85 18313</span>
<span class="co">#  6   2002 run          4.27 13746</span>
<span class="co">#  7   2003 pass         5.79 17322</span>
<span class="co">#  8   2003 run          4.24 14033</span>
<span class="co">#  9   2004 pass         6.12 17238</span>
<span class="co"># 10   2004 run          4.24 13828</span>
<span class="co"># … with 30 more rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="additional-notes" class="level1"><h1>Additional Notes</h1>
<p>I would be remiss to not mention alternative methods to getting relatively normal-sized data into memory. Using R is a great experience for small to medium sized datasets.</p>
<ul>
<li>
<code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">data.table::fread()</a></code> is super fast for reading in files
<ul>
<li>
<code>data.table</code> is also extremely fast when operating on in-memory data</li>
<li>Just like with <code>dplyr</code> and <code>dbplyr</code> for reading from databases, <code>dtplyr</code> lets you use <code>dplyr</code> call to run <code>data.table</code> queries – I’ll cover this in a follow-up post</li>
</ul>
</li>
<li>
<code><a href="https://vroom.r-lib.org/reference/vroom.html">vroom::vroom()</a></code> is even faster for reading in data in some situations</li>
</ul>
<p>In this case for our toy examples, pure <code>dplyr</code>, <code>data.table</code> and <code>dtplyr</code> are all essentially the same speed, about 0.1 - 0.2 seconds to run the same summary in-memory compared to ~ 1 sec via <code>SQLite</code>. However, the time-savings here are very much on read-in. <br></p>
<p><code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">data.table::fread()</a></code> takes about 28 seconds to read in the full csv, <code><a href="https://vroom.r-lib.org/reference/vroom.html">vroom::vroom()</a></code> takes about 20 seconds to read in the full csv, and then either <code>data.table</code> or <code>dplyr</code> take between 0.1 - 0.2 seconds to perform the aggregation. This is compared to the ~ 1 second to aggregate with the same analysis via <code>dbplyr</code> + <code>RSQLite</code>. <br></p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="fu">tic</span><span class="op">(</span><span class="op">)</span>

<span class="va">dt_pbp</span> <span class="op">&lt;-</span> <span class="fu">fread</span><span class="op">(</span><span class="st">"pbp_large.csv"</span><span class="op">)</span>

<span class="fu">toc</span><span class="op">(</span><span class="op">)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span class="co"># |--------------------------------------------------|</span>
<span class="co"># |==================================================|</span>
<span class="co"># |--------------------------------------------------|</span>
<span class="co"># |==================================================|</span>

<span class="co"># 27.875 sec elapsed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The last thing I’ll add is that if you want to do additional modeling or work with the entire dataset over a long period of time, I think it makes sense to read it into memory to get the speed improvements of in-memory computation and access to the full range of R’s capability. Just wanted to bring up that it’s possible to rapidly work on relatively large datasets and only pull into memory when you are ready. <br></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target="#callout-1" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Expand for Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.1.1 (2021-08-10)
 os       macOS Monterey 12.2.1
 system   aarch64, darwin20
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2022-04-25
 pandoc   2.18 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/tools/ (via rmarkdown)
 quarto   0.9.294 @ /usr/local/bin/quarto

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version    date (UTC) lib source
 DBI         * 1.1.1      2021-01-15 [1] CRAN (R 4.1.0)
 dplyr       * 1.0.8      2022-02-08 [1] CRAN (R 4.1.1)
 dtplyr      * 1.1.0      2021-02-20 [1] CRAN (R 4.1.0)
 forcats     * 0.5.1      2021-01-27 [1] CRAN (R 4.1.1)
 ggplot2     * 3.3.5      2021-06-25 [1] CRAN (R 4.1.1)
 nflfastR    * 4.3.0.9002 2021-10-27 [1] Github (nflverse/nflfastR@fbae5f9)
 pryr        * 0.1.5      2021-07-26 [1] CRAN (R 4.1.0)
 purrr       * 0.3.4      2020-04-17 [1] CRAN (R 4.1.0)
 readr       * 2.0.2      2021-09-27 [1] CRAN (R 4.1.1)
 RSQLite     * 2.2.8      2021-08-21 [1] CRAN (R 4.1.1)
 sessioninfo * 1.2.2      2021-12-06 [1] CRAN (R 4.1.1)
 stringr     * 1.4.0      2019-02-10 [1] CRAN (R 4.1.1)
 tibble      * 3.1.6      2021-11-07 [1] CRAN (R 4.1.1)
 tictoc      * 1.0.1      2021-04-19 [1] CRAN (R 4.1.0)
 tidyr       * 1.2.0      2022-02-01 [1] CRAN (R 4.1.1)
 tidyverse   * 1.3.1      2021-04-15 [1] CRAN (R 4.1.0)

 [1] /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</div>
</div>
</div>


</section></main><!-- /main --><script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><script src="https://utteranc.es/client.js" repo="jthomasmock/themockup-blog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>